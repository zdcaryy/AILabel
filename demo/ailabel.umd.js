!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).AILabel=t()}(this,function(){"use strict";function r(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function O(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach(function(e){u(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=h(n);return e=r?(e=h(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!=typeof e&&"function"!=typeof e?c(t):e}}function v(e,t,n){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(e){t=Object.getOwnPropertyDescriptor(e,t);return t.get?t.get.call(n):t.value}})(e,t,n||e)}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t={exports:{}},d="object"==typeof Reflect?Reflect:null,y=d&&"function"==typeof d.apply?d.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};var p=d&&"function"==typeof d.ownKeys?d.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},m=Number.isNaN||function(e){return e!=e};function g(){g.init.call(this)}t.exports=g,t.exports.once=function(s,u){return new Promise(function(e,t){function n(e){s.removeListener(u,r),t(e)}function r(){"function"==typeof s.removeListener&&s.removeListener("error",n),e([].slice.call(arguments))}var i,o,a;A(s,u,r,{once:!0}),"error"!==u&&(o=n,a={once:!0},"function"==typeof(i=s).on&&A(i,"error",o,a))})},(g.EventEmitter=g).prototype._events=void 0,g.prototype._eventsCount=0,g.prototype._maxListeners=void 0;var b=10;function x(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function k(e){return void 0===e._maxListeners?g.defaultMaxListeners:e._maxListeners}function w(e,t,n,r){var i,o;return x(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener||n),i=e._events),o=i[t]),void 0===o?(o=i[t]=n,++e._eventsCount):("function"==typeof o?o=i[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),0<(n=k(e))&&o.length>n&&!o.warned&&(o.warned=!0,(n=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=o.length,n=n,console&&console.warn&&console.warn(n))),e}function S(e,t,n){e={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},t=function(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}.bind(e);return t.listener=n,e.wrapFn=t}function P(e,t,n){e=e._events;if(void 0===e)return[];t=e[t];return void 0===t?[]:"function"==typeof t?n?[t.listener||t]:[t]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):D(t,t.length)}function M(e){var t=this._events;if(void 0!==t){e=t[e];if("function"==typeof e)return 1;if(void 0!==e)return e.length}return 0}function D(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function A(n,r,i,o){if("function"==typeof n.on)o.once?n.once(r,i):n.on(r,i);else{if("function"!=typeof n.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n);n.addEventListener(r,function e(t){o.once&&n.removeEventListener(r,e),i(t)})}}Object.defineProperty(g,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(e){if("number"!=typeof e||e<0||m(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");b=e}}),g.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},g.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||m(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},g.prototype.getMaxListeners=function(){return k(this)},g.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r,i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){if((r=0<t.length?t[0]:r)instanceof Error)throw r;i=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw i.context=r,i}e=o[e];if(void 0===e)return!1;if("function"==typeof e)y(e,this,t);else for(var a=e.length,s=D(e,a),n=0;n<a;++n)y(s[n],this,t);return!0},g.prototype.on=g.prototype.addListener=function(e,t){return w(this,e,t,!1)},g.prototype.prependListener=function(e,t){return w(this,e,t,!0)},g.prototype.once=function(e,t){return x(t),this.on(e,S(this,e,t)),this},g.prototype.prependOnceListener=function(e,t){return x(t),this.prependListener(e,S(this,e,t)),this},g.prototype.removeListener=function(e,t){var n,r,i,o,a;if(x(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;0<=o;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},g.prototype.off=g.prototype.removeListener,g.prototype.removeAllListeners=function(e){var t,n=this._events;if(void 0===n)return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(o=t.length-1;0<=o;o--)this.removeListener(e,t[o]);return this},g.prototype.listeners=function(e){return P(this,e,!0)},g.prototype.rawListeners=function(e){return P(this,e,!1)},g.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):M.call(e,t)},g.prototype.listenerCount=M,g.prototype.eventNames=function(){return 0<this._eventsCount?p(this._events):[]};var j=t.exports,F="object"==typeof e&&e&&e.Object===Object&&e,I="object"==typeof self&&self&&self.Object===Object&&self,_=F||I||Function("return this")(),L=_.Symbol,E=Object.prototype,T=E.hasOwnProperty,R=E.toString,U=L?L.toStringTag:void 0;var z=Object.prototype.toString;var G=function(e){var t=T.call(e,U),n=e[U];try{var r=!(e[U]=void 0)}catch(e){}var i=R.call(e);return r&&(t?e[U]=n:delete e[U]),i},B=function(e){return z.call(e)},W=L?L.toStringTag:void 0;var N=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":(W&&W in Object(e)?G:B)(e)};var Y=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},X=N,$=Y;var K=function(e){return!!$(e)&&("[object Function]"==(e=X(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)},q=_["__core-js_shared__"],V=(Nt=/[^.]+$/.exec(q&&q.keys&&q.keys.IE_PROTO||""))?"Symbol(src)_1."+Nt:"";var Z=Function.prototype.toString;var J=function(e){if(null!=e){try{return Z.call(e)}catch(e){}try{return e+""}catch(e){}}return""},H=K,Q=function(e){return!!V&&V in e},ee=Y,te=J,ne=/^\[object .+?Constructor\]$/,re=Function.prototype,ie=Object.prototype,oe=re.toString,ae=ie.hasOwnProperty,se=RegExp("^"+oe.call(ae).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ue=function(e){return!(!ee(e)||Q(e))&&(H(e)?se:ne).test(te(e))},le=function(e,t){return null==e?void 0:e[t]};var he=function(e,t){return t=le(e,t),ue(t)?t:void 0},ce=he,fe=function(){try{var e=ce(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),ve=fe;var de=function(e,t,n){"__proto__"==t&&ve?ve(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var ye=function(e,t){return e===t||e!=e&&t!=t},pe=de,me=ye,ge=Object.prototype.hasOwnProperty;function be(e,t,n){var r=e[t];ge.call(e,t)&&me(r,n)&&(void 0!==n||t in e)||pe(e,t,n)}var xe=be,ke=de;var we=function(e,t,n,r){var i=!n;n=n||{};for(var o=-1,a=t.length;++o<a;){var s=t[o],u=r?r(n[s],e[s],s,n,e):void 0;void 0===u&&(u=e[s]),(i?ke:xe)(n,s,u)}return n};var Se=function(e){return e};var Pe=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},Me=Math.max;var De=function(o,a,s){return a=Me(void 0===a?o.length-1:a,0),function(){for(var e=arguments,t=-1,n=Me(e.length-a,0),r=Array(n);++t<n;)r[t]=e[a+t];for(var t=-1,i=Array(a+1);++t<a;)i[t]=e[t];return i[a]=s(r),Pe(o,this,i)}};var Oe=function(e){return function(){return e}},Ce=fe,Ae=Date.now;var je=function(n){var r=0,i=0;return function(){var e=Ae(),t=16-(e-i);if(i=e,0<t){if(800<=++r)return arguments[0]}else r=0;return n.apply(void 0,arguments)}}(Ce?function(e,t){return Ce(e,"toString",{configurable:!0,enumerable:!1,value:Oe(t),writable:!0})}:Se),Fe=Se,Ie=De,_e=je;function Le(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=9007199254740991}var Ee=K,Te=Le;var Re=function(e){return null!=e&&Te(e.length)&&!Ee(e)},Ue=/^(?:0|[1-9]\d*)$/;function ze(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Ue.test(e))&&-1<e&&e%1==0&&e<t}var Ge=ye,Be=Re,We=ze,Ne=Y;var Ye=function(e,t){return _e(Ie(e,t,Fe),e+"")},Xe=function(e,t,n){if(!Ne(n))return!1;var r=typeof t;return!!("number"==r?Be(n)&&We(t,n.length):"string"==r&&t in n)&&Ge(n[t],e)};var $e=function(s){return Ye(function(e,t){var n=-1,r=t.length,i=1<r?t[r-1]:void 0,o=2<r?t[2]:void 0,i=3<s.length&&"function"==typeof i?(r--,i):void 0;for(o&&Xe(t[0],t[1],o)&&(i=r<3?void 0:i,r=1),e=Object(e);++n<r;){var a=t[n];a&&s(e,a,n,i)}return e})},Ke=Object.prototype;var qe=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Ke)};var Ve=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r};var Ze=function(e){return null!=e&&"object"==typeof e},Je=N,He=Ze;var Qe=function(e){return He(e)&&"[object Arguments]"==Je(e)},et=Ze,tt=Object.prototype,nt=tt.hasOwnProperty,rt=tt.propertyIsEnumerable,it=Qe(function(){return arguments}())?Qe:function(e){return et(e)&&nt.call(e,"callee")&&!rt.call(e,"callee")},ot=Array.isArray,at={exports:{}};On=(On=(bn=(On=(bn=(kn=at).exports)&&!bn.nodeType&&bn)&&kn&&!kn.nodeType&&kn)&&bn.exports===On?_.Buffer:void 0)?On.isBuffer:void 0,kn.exports=On||function(){return!1};var st=N,ut=Le,lt=Ze,ht={};ht["[object Float32Array]"]=ht["[object Float64Array]"]=ht["[object Int8Array]"]=ht["[object Int16Array]"]=ht["[object Int32Array]"]=ht["[object Uint8Array]"]=ht["[object Uint8ClampedArray]"]=ht["[object Uint16Array]"]=ht["[object Uint32Array]"]=!0,ht["[object Arguments]"]=ht["[object Array]"]=ht["[object ArrayBuffer]"]=ht["[object Boolean]"]=ht["[object DataView]"]=ht["[object Date]"]=ht["[object Error]"]=ht["[object Function]"]=ht["[object Map]"]=ht["[object Number]"]=ht["[object Object]"]=ht["[object RegExp]"]=ht["[object Set]"]=ht["[object String]"]=ht["[object WeakMap]"]=!1;var ct=function(e){return lt(e)&&ut(e.length)&&!!ht[st(e)]};var ft,vt,dt=function(t){return function(e){return t(e)}},yt={exports:{}};An=(An=(Cn=yt).exports)&&!An.nodeType&&An,ft=An&&Cn&&!Cn.nodeType&&Cn,vt=ft&&ft.exports===An&&F.process,An=function(){try{var e=ft&&ft.require&&ft.require("util").types;return e?e:vt&&vt.binding&&vt.binding("util")}catch(e){}}(),Cn.exports=An;var pt=ct,mt=dt,gt=yt.exports,bt=gt&&gt.isTypedArray,xt=bt?mt(bt):pt,kt=Ve,wt=it,St=ot,Pt=at.exports,Mt=ze,Dt=xt,Ot=Object.prototype.hasOwnProperty;d=function(e,t){var n,r=St(e),i=!r&&wt(e),o=!r&&!i&&Pt(e),a=!r&&!i&&!o&&Dt(e),s=r||i||o||a,u=s?kt(e.length,String):[],l=u.length;for(n in e)!t&&!Ot.call(e,n)||s&&("length"==n||o&&("offset"==n||"parent"==n)||a&&("buffer"==n||"byteLength"==n||"byteOffset"==n)||Mt(n,l))||u.push(n);return u};var t=function(t,n){return function(e){return t(n(e))}},e=t(Object.keys,Object),Ct=qe,At=e,jt=Object.prototype.hasOwnProperty;var Ft=d,It=function(e){if(!Ct(e))return At(e);var t,n=[];for(t in Object(e))jt.call(e,t)&&"constructor"!=t&&n.push(t);return n},_t=Re;var I=function(e){return(_t(e)?Ft:It)(e)},Lt=be,Et=we,E=$e,Tt=Re,Rt=qe,Ut=I,zt=Object.prototype.hasOwnProperty,Gt=E(function(e,t){if(Rt(t)||Tt(t))Et(t,Ut(t),e);else for(var n in t)zt.call(t,n)&&Lt(e,n,t[n])});var q=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i},Bt=N,Wt=Ze;var Nt=function(e){return"symbol"==typeof e||Wt(e)&&"[object Symbol]"==Bt(e)},Yt=q,Xt=ot,$t=Nt,re=L?L.prototype:void 0,Kt=re?re.toString:void 0;var qt=function e(t){if("string"==typeof t)return t;if(Xt(t))return Yt(t,e)+"";if($t(t))return Kt?Kt.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};var ie=function(e){return null==e?"":qt(e)},Vt=ie,Zt=0;var Jt=function(e){var t=++Zt;return Vt(e)+t};oe=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e};var Ht=function(u){return function(e,t,n){for(var r=-1,i=Object(e),o=n(e),a=o.length;a--;){var s=o[u?a:++r];if(!1===t(i[s],s,i))break}return e}}(),Qt=I;var en=Re;var ae=function(o,a){return function(e,t){if(null==e)return e;if(!en(e))return o(e,t);for(var n=e.length,r=a?n:-1,i=Object(e);(a?r--:++r<n)&&!1!==t(i[r],r,i););return e}}(function(e,t){return e&&Ht(e,t,Qt)}),tn=Se;var nn=oe,rn=ae,on=function(e){return"function"==typeof e?e:tn},an=ot;var sn=function(e,t){return(an(e)?nn:rn)(e,on(t))},un=ot,ln=Nt,hn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,cn=/^\w*$/;var de=function(e,t){if(un(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!ln(e))||(cn.test(e)||!hn.test(e)||null!=t&&e in Object(t))},fe=he(Object,"create"),fn=fe;var vn=fe,dn=Object.prototype.hasOwnProperty;var yn=fe,pn=Object.prototype.hasOwnProperty;var mn=fe;De=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},je=function(e){var t=this.__data__;if(vn){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return dn.call(t,e)?t[e]:void 0},tt=function(e){var t=this.__data__;return yn?void 0!==t[e]:pn.call(t,e)},Qe=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=mn&&void 0===t?"__lodash_hash_undefined__":t,this};function gn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}gn.prototype.clear=function(){this.__data__=fn?fn(null):{},this.size=0},gn.prototype.delete=De,gn.prototype.get=je,gn.prototype.has=tt,gn.prototype.set=Qe;var bn=gn;var xn=ye;var kn=function(e,t){for(var n=e.length;n--;)if(xn(e[n][0],t))return n;return-1},wn=kn,Sn=Array.prototype.splice;var Pn=kn;var Mn=kn;var Dn=kn;var On=function(e){var t=this.__data__;return!((e=wn(t,e))<0)&&(e==t.length-1?t.pop():Sn.call(t,e,1),--this.size,!0)},F=function(e){var t=this.__data__;return(e=Pn(t,e))<0?void 0:t[e][1]},Cn=function(e){return-1<Mn(this.__data__,e)},An=function(e,t){var n=this.__data__,r=Dn(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function jn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}jn.prototype.clear=function(){this.__data__=[],this.size=0},jn.prototype.delete=On,jn.prototype.get=F,jn.prototype.has=Cn,jn.prototype.set=An;var ct=jn,gt=he(_,"Map"),Fn=bn,In=ct,_n=gt;mt=function(){this.size=0,this.__data__={hash:new Fn,map:new(_n||In),string:new Fn}};var Ln=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var bt=function(e,t){return e=e.__data__,Ln(t)?e["string"==typeof t?"string":"hash"]:e.map},En=bt;var Tn=bt;var Rn=bt;var Un=bt;pt=function(e){return e=En(this,e).delete(e),this.size-=e?1:0,e},Ve=function(e){return Tn(this,e).get(e)},e=function(e){return Rn(this,e).has(e)},$e=function(e,t){var n=Un(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function zn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}zn.prototype.clear=mt,zn.prototype.delete=pt,zn.prototype.get=Ve,zn.prototype.has=e,zn.prototype.set=$e;var E=zn,Gn=E;function Bn(r,i){if("function"!=typeof r||null!=i&&"function"!=typeof i)throw new TypeError("Expected a function");function o(){var e=arguments,t=i?i.apply(this,e):e[0],n=o.cache;return n.has(t)?n.get(t):(e=r.apply(this,e),o.cache=n.set(t,e)||n,e)}return o.cache=new(Bn.Cache||Gn),o}Bn.Cache=Gn;var Wn=Bn;var Nn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Yn=/\\(\\)?/g,re=function(e){var t=(e=Wn(e,function(e){return 500===t.size&&t.clear(),e})).cache;return e}(function(e){var i=[];return 46===e.charCodeAt(0)&&i.push(""),e.replace(Nn,function(e,t,n,r){i.push(n?r.replace(Yn,"$1"):t||e)}),i}),Xn=ot,$n=de,Kn=re,qn=ie;var fe=function(e,t){return Xn(e)?e:$n(e,t)?[e]:Kn(qn(e))},Vn=Nt;var De=function(e){if("string"==typeof e||Vn(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t},Zn=fe,Jn=De;var je=function(e,t){for(var n=0,r=(t=Zn(t,e)).length;null!=e&&n<r;)e=e[Jn(t[n++])];return n&&n==r?e:void 0},Hn=je;var Qn=function(e,t,n){return void 0===(t=null==e?void 0:Hn(e,t))?n:t},er=N,tr=Ze;var nr=function(e){return"number"==typeof e||tr(e)&&"[object Number]"==er(e)};var tt=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o},rr=ae;var Qe=function(e,r){var i=[];return rr(e,function(e,t,n){r(e,t,n)&&i.push(e)}),i},ir=ct;kn=function(){this.__data__=new ir,this.size=0};var or=ct,ar=gt,sr=E;var ur=ct,On=function(e){var t=this.__data__,e=t.delete(e);return this.size=t.size,e},F=function(e){return this.__data__.get(e)},Cn=function(e){return this.__data__.has(e)},An=function(e,t){var n=this.__data__;if(n instanceof or){var r=n.__data__;if(!ar||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new sr(r)}return n.set(e,t),this.size=n.size,this};function lr(e){e=this.__data__=new ur(e);this.size=e.size}lr.prototype.clear=kn,lr.prototype.delete=On,lr.prototype.get=F,lr.prototype.has=Cn,lr.prototype.set=An;bn=lr;var hr=E,bt=function(e){return this.__data__.has(e)};function cr(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new hr;++t<n;)this.add(e[t])}cr.prototype.add=cr.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},cr.prototype.has=bt;mt=cr;var pt=function(e,t){return e.has(t)},fr=mt,vr=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},dr=pt;Ve=function(e,t,n,r,i,o){var a=1&n,s=e.length,u=t.length;if(s!=u&&!(a&&s<u))return!1;var l=o.get(e),u=o.get(t);if(l&&u)return l==t&&u==e;var h=-1,c=!0,f=2&n?new fr:void 0;for(o.set(e,t),o.set(t,e);++h<s;){var v,d=e[h],y=t[h];if(void 0!==(v=r?a?r(y,d,h,t,e,o):r(d,y,h,e,t,o):v)){if(v)continue;c=!1;break}if(f){if(!vr(t,function(e,t){if(!dr(f,t)&&(d===e||i(d,e,n,r,o)))return f.push(t)})){c=!1;break}}else if(d!==y&&!i(d,y,n,r,o)){c=!1;break}}return o.delete(e),o.delete(t),c},e=_.Uint8Array;function yr(e){var n=-1,r=Array(e.size);return e.forEach(function(e,t){r[++n]=[t,e]}),r}var $e=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n},pr=e,mr=ye,gr=Ve,br=$e,re=L?L.prototype:void 0,xr=re?re.valueOf:void 0;ie=function(e,t,n,r,i,o,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return e.byteLength==t.byteLength&&o(new pr(e),new pr(t))?!0:!1;case"[object Boolean]":case"[object Date]":case"[object Number]":return mr(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=yr;case"[object Set]":s=s||br;if(e.size!=t.size&&!(1&r))return!1;var u=a.get(e);if(u)return u==t;r|=2,a.set(e,t);s=gr(s(e),s(t),r,i,o,a);return a.delete(e),s;case"[object Symbol]":if(xr)return xr.call(e)==xr.call(t)}return!1};var ct=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},kr=ct,wr=ot;kn=function(e,t,n){return t=t(e),wr(e)?t:kr(t,n(e))};var On=function(){return[]},Sr=tt,Pr=Object.prototype.propertyIsEnumerable,Mr=Object.getOwnPropertySymbols,F=Mr?function(t){return null==t?[]:(t=Object(t),Sr(Mr(t),function(e){return Pr.call(t,e)}))}:On,Dr=kn,Or=F,Cr=I;var Cn=function(e){return Dr(e,Cr,Or)},Ar=Cn,jr=Object.prototype.hasOwnProperty;var An=function(e,t,n,r,i,o){var a=1&n,s=Ar(e),u=s.length;if(u!=Ar(t).length&&!a)return!1;for(var l=u;l--;){var h=s[l];if(!(a?h in t:jr.call(t,h)))return!1}var c=o.get(e),f=o.get(t);if(c&&f)return c==t&&f==e;var v=!0;o.set(e,t),o.set(t,e);for(var d=a;++l<u;){var y,p=e[h=s[l]],m=t[h];if(!(void 0===(y=r?a?r(m,p,h,t,e,o):r(p,m,h,e,t,o):y)?p===m||i(p,m,n,r,o):y)){v=!1;break}d=d||"constructor"==h}return!v||d||(c=e.constructor)!=(f=t.constructor)&&"constructor"in e&&"constructor"in t&&!("function"==typeof c&&c instanceof c&&"function"==typeof f&&f instanceof f)&&(v=!1),o.delete(e),o.delete(t),v},E=he(_,"DataView"),bt=he(_,"Promise"),ye=he(_,"Set"),re=E,E=gt,gt=bt,bt=ye,he=he(_,"WeakMap"),Fr=N,Ir=J,_r="[object Map]",Lr="[object Promise]",Er="[object Set]",Tr="[object WeakMap]",Rr="[object DataView]",Ur=Ir(re),zr=Ir(E),Gr=Ir(gt),Br=Ir(bt),Wr=Ir(he),J=Fr,J=J=re&&J(new re(new ArrayBuffer(1)))!=Rr||E&&J(new E)!=_r||gt&&J(gt.resolve())!=Lr||bt&&J(new bt)!=Er||he&&J(new he)!=Tr?function(e){var t=Fr(e),e="[object Object]"==t?e.constructor:void 0,e=e?Ir(e):"";if(e)switch(e){case Ur:return Rr;case zr:return _r;case Gr:return Lr;case Br:return Er;case Wr:return Tr}return t}:J,Nr=bn,Yr=Ve,Xr=ie,$r=An,Kr=J,qr=ot,Vr=at.exports,Zr=xt,Jr="[object Arguments]",Hr="[object Array]",Qr="[object Object]",ei=Object.prototype.hasOwnProperty;var ti=function(e,t,n,r,i,o){var a=qr(e),s=qr(t),u=a?Hr:Kr(e),l=s?Hr:Kr(t),h=(u=u==Jr?Qr:u)==Qr,s=(l=l==Jr?Qr:l)==Qr;if((l=u==l)&&Vr(e)){if(!Vr(t))return!1;h=!(a=!0)}if(l&&!h)return o=o||new Nr,a||Zr(e)?Yr(e,t,n,r,i,o):Xr(e,t,u,n,r,i,o);if(!(1&n)){h=h&&ei.call(e,"__wrapped__"),s=s&&ei.call(t,"__wrapped__");if(h||s)return i(h?e.value():e,s?t.value():t,n,r,o=o||new Nr)}return!!l&&(o=o||new Nr,$r(e,t,n,r,i,o))},ni=Ze;var ie=function e(t,n,r,i,o){return t===n||(null==t||null==n||!ni(t)&&!ni(n)?t!=t&&n!=n:ti(t,n,r,i,e,o))},ri=bn,ii=ie;var oi=Y;var An=function(e){return e==e&&!oi(e)},ai=An,si=I;var xt=function(t,n){return function(e){return null!=e&&(e[t]===n&&(void 0!==n||t in Object(e)))}},ui=function(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=Object(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var u=(s=n[i])[0],l=e[u],h=s[1];if(a&&s[2]){if(void 0===l&&!(u in e))return!1}else{var c,f=new ri;if(!(void 0===(c=r?r(l,h,u,e,t,f):c)?ii(h,l,3,r,f):c))return!1}}return!0},li=function(e){for(var t=si(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,ai(i)]}return t},hi=xt;var ci=fe,fi=it,vi=ot,di=ze,yi=Le,pi=De;function mi(e,t){return null!=e&&t in Object(e)}var gi=function(e,t,n){for(var r=-1,i=(t=ci(t,e)).length,o=!1;++r<i;){var a=pi(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&yi(i)&&di(a,i)&&(vi(e)||fi(e))};var bi=ie,xi=Qn,ki=function(e,t){return null!=e&&gi(e,t,mi)},wi=de,Si=An,Pi=xt,Mi=De;var Di=je;var Oi=function(t){return function(e){return null==e?void 0:e[t]}},Ci=function(t){return function(e){return Di(e,t)}},Ai=de,ji=De;var Fi=function(t){var n=li(t);return 1==n.length&&n[0][2]?hi(n[0][0],n[0][1]):function(e){return e===t||ui(e,t,n)}},Ii=function(n,r){return wi(n)&&Si(r)?Pi(Mi(n),r):function(e){var t=xi(e,n);return void 0===t&&t===r?ki(e,n):bi(r,t,3)}},_i=Se,Li=ot,Ei=function(e){return Ai(e)?Oi(ji(e)):Ci(e)};var Se=function(e){return"function"==typeof e?e:null==e?_i:"object"==typeof e?Li(e)?Ii(e[0],e[1]):Fi(e):Ei(e)},Ti=tt,Ri=Qe,Ui=Se,zi=ot;var Gi,Bi,Wi,Ni,Yi=function(e,t){return(zi(e)?Ti:Ri)(e,Ui(t))};(Qe=Gi=Gi||{}).Bottom="bottom",Qe.Top="top",Qe.Middle="middle",(Qe=Bi=Bi||{}).Pan="PAN",Qe.MARKER="MARKER",Qe.Point="POINT",Qe.Circle="CIRCLE",Qe.Line="LINE",Qe.Polyline="POLYLINE",Qe.Rect="RECT",Qe.Polygon="POLYGON",Qe.DrawMask="DRAWMASK",Qe.ClearMask="CLEARMASK",Qe.ImageMask="IMAGEMASK",(Qe=Wi=Wi||{}).BoundsChanged="boundsChanged",Qe.FeatureSelected="featureSelected",Qe.FeatureUnselected="featureUnselected",Qe.DrawDone="drawDone",Qe.FeatureUpdated="featureUpdated",Qe.FeatureDeleted="featureDeleted",(Qe=Ni=Ni||{}).Grab="-webkit-grab",Qe.Grabbing="-webkit-grabbing",Qe.Crosshair="crosshair",Qe.Pointer="pointer",Qe.Move="move",Qe.NESW_Resize="nesw-resize",Qe.NWSE_Resize="nwse-resize";var Xi=ae,$i=Re;function Ki(e,r){var i=-1,o=$i(e)?Array(e.length):[];return Xi(e,function(e,t,n){o[++i]=r(e,t,n)}),o}var qi=q,Vi=Se,Zi=ot;var Ji=function(e,t){return(Zi(e)?qi:Ki)(e,Vi(t))};function Hi(e){return e!=e}var Qi=function(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1},eo=function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1};var ae=function(e,t,n){return t==t?eo(e,t,n):Qi(e,Hi,n)},to=N,no=ot,ro=Ze;var io=/\s/;var oo=function(e){for(var t=e.length;t--&&io.test(e.charAt(t)););return t},ao=/^\s+/;var so=function(e){return e&&e.slice(0,oo(e)+1).replace(ao,"")},uo=Y,lo=Nt,ho=/^[-+]0x[0-9a-f]+$/i,co=/^0b[01]+$/i,fo=/^0o[0-7]+$/i,vo=parseInt;var yo=function(e){if("number"==typeof e)return e;if(lo(e))return NaN;if(uo(e)&&(t="function"==typeof e.valueOf?e.valueOf():e,e=uo(t)?t+"":t),"string"!=typeof e)return 0===e?e:+e;e=so(e);var t=co.test(e);return t||fo.test(e)?vo(e.slice(2),t?2:8):ho.test(e)?NaN:+e};var po=function(e){return e?(e=yo(e))!==1/0&&e!==-1/0?e==e?e:0:17976931348623157e292*(e<0?-1:1):0===e?e:0};var mo=q;var go=function(t,e){return mo(e,function(e){return t[e]})},bo=I;var xo=ae,ko=Re,wo=function(e){return"string"==typeof e||!no(e)&&ro(e)&&"[object String]"==to(e)},So=function(e){var t=po(e),e=t%1;return t==t?e?t-e:t:0},Po=function(e){return null==e?[]:go(e,bo(e))},Mo=Math.max;var Do,Oo=function(e,t,n,r){return e=ko(e)?e:Po(e),n=n&&!r?So(n):0,r=e.length,n<0&&(n=Mo(r+n,0)),wo(e)?n<=r&&-1<e.indexOf(t,n):!!r&&-1<xo(e,t,n)};(Se=Do=Do||{}).Draw="DRAW",Se.Clear="CLEAR",Se.Image="IMAGE";var Co=function(){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};s(this,i),this.id=e,this.type=t,this.props=n,this.style=Gt({},i.defaultStyle,r)}return n(i,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){}},{key:"setStyle",value:function(e,t){var n,t=t.refresh,t=void 0===t||t;this.style=e,t&&null!==(n=this.layer)&&void 0!==n&&n.refresh()}},{key:"refresh",value:function(){}},{key:"printInfo",value:function(){}}]),i}();u(Co,"defaultStyle",{opacity:1,fillStyle:"rgba(255, 0, 0, 0)",lineWidth:1,strokeStyle:"#000"});var Ao=function(){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};s(this,i),this.id=e,this.type=t,this.props=n,this.style=Gt({},i.defaultStyle,r),this.domId="layer-".concat(e,"-wrapper"),this.setDom()}return n(i,[{key:"setDom",value:function(){this.dom||(this.dom=document.createElement("div"),this.dom.setAttribute("id",this.domId),this.dom.style.position="absolute",this.dom.style.left="0",this.dom.style.top="0");var e=this.style,t=e.zIndex,e=e.opacity;this.dom.style.zIndex="".concat(t),this.dom.style.opacity="".concat(e)}},{key:"onAdd",value:function(e){this.map=e,this.resize()}},{key:"onRemove",value:function(){var e=document.getElementById(this.domId);e&&e.remove()}},{key:"resize",value:function(){var e=this.map.getSize(),t=e.width,e=e.height;this.dom.style.width="".concat(t,"px"),this.dom.style.height="".concat(e,"px")}},{key:"refresh",value:function(){}},{key:"resizeAndRefresh",value:function(){this.resize(),this.refresh()}},{key:"printInfo",value:function(){}}]),i}();u(Ao,"defaultStyle",{zIndex:1,opacity:1});var jo=function(){l(o,Ao);var i=f(o);function o(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return s(this,o),i.call(this,e,t,n,r)}return n(o,[{key:"onAdd",value:function(e){v(h(o.prototype),"onAdd",this).call(this,e),this.createRenderCanvas()}},{key:"createRenderCanvas",value:function(){var e=this.map.getSize(),t=e.width,n=e.height,e=document.createElement("canvas");e.style.position="absolute",e.style.left="0",e.style.top="0",e.width=t*o.dpr,e.height=n*o.dpr,e.style.width=t+"px",e.style.height=n+"px",this.dom.appendChild(e),this.canvas=e,this.canvasContext=e.getContext("2d")}},{key:"refresh",value:function(){v(h(o.prototype),"refresh",this).call(this),this.clear()}},{key:"clear",value:function(){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)}}]),o}();u(jo,"dpr",window.devicePixelRatio);var Fo=function(){function m(){s(this,m)}return n(m,null,[{key:"setStyle",value:function(r){var e=Gt({},m.defaultStyle,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{});sn(e,function(e,t){var n;K(m.formatStyle[t])?(n=m.formatStyle[t](e),r[t]=n):r[t]=e})}},{key:"drawPolyline",value:function(e,t,n,r){var i=r.format,r=r.limitCount,r=void 0===r?2:r,t=K(i)?i(t):t,o=t.points,t=t.width,a=o.length;if(!(a<r)){m.setStyle(e,n),nr(t)&&(e.lineWidth=t),e.beginPath();n=o[0],t=n.x,n=n.y;e.moveTo(t,n);for(var s=1;s<a;s++){var u=o[s],l=u.x,u=u.y;e.lineTo(l,u)}e.stroke()}}},{key:"drawLine",value:function(e,t,n,r){m.setStyle(e,n);n=(r||{}).format,r=K(n)?n(t):t,n=r.start,t=r.end,r=r.width;nr(r)&&(e.lineWidth=r),e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(t.x,t.y),e.stroke()}},{key:"drawRect",value:function(e,t,n,r){var i=r||{},o=i.format,a=i.fill,s=void 0!==a&&a,r=i.stroke,a=void 0===r||r,i=K(o)?o(t):t,r=i.x,o=i.y,t=r+i.width,i=o+i.height;m.drawPolygon(e,[{x:r,y:o},{x:t,y:o},{x:t,y:i},{x:r,y:i}],n,{fill:s,stroke:a})}},{key:"drawPolygon",value:function(e,t,n,r){var i=r.format,o=r.stroke,a=void 0===o||o,s=r.fill,o=void 0!==s&&s,s=r.limitCount,r=r.closePath,r=void 0===r||r,u=t.length;if(!(u<(void 0===s?2:s))){m.setStyle(e,n),e.beginPath();s=K(i)?i(t[0]):t[0],n=s.x,s=s.y;e.moveTo(n,s);for(var l=1;l<u;l++){var h=K(i)?i(t[l]):t[l],c=h.x,h=h.y;e.lineTo(c,h)}r&&e.closePath(),o&&e.fill(),a&&e.stroke()}}},{key:"drawCircle",value:function(e,t,n,r){var i=r.format,o=r.stroke,a=void 0===o||o,o=r.fill,r=void 0===o||o,o=K(i)?i(t):t,i=o.cx,t=o.cy,o=o.r;m.setStyle(e,n),e.beginPath(),e.arc(i,t,o,0,2*Math.PI),r&&e.fill(),a&&e.stroke()}},{key:"drawPoint",value:function(e,t,n,r){var i=r.format,r=K(i)?i(t):t,i=r.x,t=r.y,r=r.r,r=void 0===r?2:r;m.setStyle(e,n),e.beginPath(),e.arc(i,t,r,0,2*Math.PI),e.fill()}},{key:"drawImage",value:function(e,t,n){var r=t.image,i=t.x,o=t.y,a=t.width,t=t.height;e.drawImage(r,i,o,a,t)}},{key:"drawText",value:function(e,t,n,r){var i=n.background,o=r.format,a=r.fill,s=void 0===a||a,u=K(o)?o(t):t,l=u.text,h=u.position,c=u.offset;m.setStyle(e,n);var f=h.x+c.x,v=h.y-c.y,d=e.lineWidth,y=3*jo.dpr,p=4*jo.dpr,r=e.textBaseline===Gi.Bottom,a=e.textBaseline===Gi.Top,o=e.textBaseline===Gi.Middle;i&&(t=e.measureText(l).width,u=parseInt(e.font.replace(/[^0-9]/gi,""),10)+2*y,c=h.y,r&&(c-=u),o&&(c-=u/2),u={x:h.x,y:c,width:t+2*p,height:u},m.drawRect(e,u,n,{fill:!0})),e.globalAlpha=1,s?(e.fillStyle=n.fontColor,r&&i&&e.fillText(l,f+p,v-y+d),o&&i&&e.fillText(l,f+p,v),a&&i&&e.fillText(l,f+p,v+y+d),i||e.fillText(l,f,v)):(e.strokeStyle=n.fontColor,r&&i&&e.strokeText(l,f+p,v-y+d),o&&i&&e.strokeText(l,f+p,v),a&&i&&e.strokeText(l,f+p,v+y+d),i||e.strokeText(l,f,v))}}]),m}();u(Fo,"defaultStyle",{fillStyle:"#FF0000",strokeStyle:"#FF0000",lineWidth:1,font:"normal 12px Arial",globalAlpha:1,lineCap:"round",lineJoin:"round",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0}),u(Fo,"formatStyle",{lineWidth:function(e){return e*jo.dpr},font:function(e){var t=e.replace(/[^0-9]/gi,""),n=parseInt(t,10)*jo.dpr,t=new RegExp("".concat(t),"g");return e.replace(t,"".concat(n))}});var Io,_o,Lo,Eo=function(){l(o,Co);var i=f(o);function o(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return s(this,o),(r=i.call(this,e,Do.Clear,n,r)).shape=t,r}return n(o,[{key:"refresh",value:function(){var n=this,r=jo.dpr,i=this.layer.map.getScale(),e=O(O({},this.style||{}),{},{lineCap:"round",lineJoin:"round"});this.layer.canvasContext.globalCompositeOperation="destination-out",Fo.drawPolyline(this.layer.canvasContext,this.shape,e,{format:function(e){var t=e.points,e=e.width;return O({points:Ji(t,function(e){var t=n.layer.map.transformGlobalToScreen(e),e=t.x,t=t.y;return{x:e*r,y:t*r}})},nr(e)?{width:e*i*r}:{})}}),this.layer.canvasContext.globalCompositeOperation="source-over"}}]),o}();(N=Io=Io||{}).Image="IMAGE",N.Feature="FEATURE",N.Event="EVENT",N.Mask="MASK",N.Text="TEXT",N.Marker="MARKER",N.Overlay="OVERLAY",(Nt=_o=_o||{}).Point="POINT",Nt.Line="LINE",Nt.Polyline="POLYLINE",Nt.Polygon="POLYGON",Nt.Rect="RECT",Nt.Circle="CIRCLE",(q=Lo=Lo||{}).Global="GLOBAL",q.Screen="SCREEN";function To(){s(this,To)}u(To,"MathUtil",{getMiddlePoint:function(e,t){var n=e.x,e=e.y;return{x:(n+t.x)/2,y:(e+t.y)/2}},distance:function(e,t){var n=e.x,e=e.y,n=n-t.x,t=e-t.y;return Math.sqrt(n*n+t*t)},pointInPolygon:function(e,t){for(var n=e.x,r=e.y,i=!1,o=-1,a=t.length,s=a-1;++o<a;s=o){var u=t[o],l=u.x,h=u.y,c=t[s],u=c.x,c=c.y;(h<=r&&r<c||c<=r&&r<h)&&n<(u-l)*(r-h)/(c-h)+l&&(i=!i)}return i},pointInRect:function(e,t){var n=e.x,r=e.y,i=t.x,o=t.y,e=t.width,t=t.height;return i<=n&&n<=i+e&&o-t<=r&&r<=o},pointInPoint:function(e,t){var n=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).tolerance;return To.MathUtil.distance(e,t)<=n},pointInPolyline:function(n,r){var i=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).tolerance,o=r.length-1,a=!1;return sn(r,function(e,t){if(t!==o){t=r[t+1];return To.MathUtil.distancePoint2Line(n,e,t)<=i?!(a=!0):void 0}}),a},distancePoint2Line:function(e,t,n){var r=e.x,i=e.y,o=t.x,a=t.y,s=n.x,u=n.y,e=s-o,t=u-a,n=e*e+t*t,n=0!=n?((r-o)*e+(i-a)*t)/n:-1,t=n<0?(l=o,a):1<n?(l=s,u):(l=o+n*e,a+n*t),l=r-l,t=i-t;return Math.sqrt(l*l+t*t)}}),u(To,"EventUtil",{getButtonIndex:function(e){if(!+[1])switch(e.button){case 0:case 1:case 3:case 5:case 7:return 0;case 2:case 6:return 2;case 4:return 1}return e.button}});var Ro=function(){l(i,Ao);var r=f(i);function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return s(this,i),u(c(n=r.call(this,e,Io.Event,t,n)),"dragging",!1),u(c(n),"tmpPointsStore",[]),u(c(n),"hoverFeature",null),u(c(n),"hoverFeatureIndex",void 0),n.onMouseDown=n.onMouseDown.bind(c(n)),n.onMouseMove=n.onMouseMove.bind(c(n)),n.onMouseUp=n.onMouseUp.bind(c(n)),n.onMouseDblClick=n.onMouseDblClick.bind(c(n)),n.onMouseWheel=n.onMouseWheel.bind(c(n)),n.handleMapPanMove=n.handleMapPanMove.bind(c(n)),n.handleMapPanEnd=n.handleMapPanEnd.bind(c(n)),n.handleRectMove=n.handleRectMove.bind(c(n)),n.handleRectEnd=n.handleRectEnd.bind(c(n)),n.handlePolygonMove=n.handlePolygonMove.bind(c(n)),n.handleMaskMove=n.handleMaskMove.bind(c(n)),n.handleMaskEnd=n.handleMaskEnd.bind(c(n)),n.handleActiveFeatureMove=n.handleActiveFeatureMove.bind(c(n)),n.handleActiveFeatureEnd=n.handleActiveFeatureEnd.bind(c(n)),n}return n(i,[{key:"onAdd",value:function(e){v(h(i.prototype),"onAdd",this).call(this,e),this.createEventDom(),this.dom.appendChild(this.eventDom),this.addEventListener()}},{key:"createEventDom",value:function(){this.eventDom=document.createElement("div"),this.eventDom.style.position="absolute",this.eventDom.style.left="0",this.eventDom.style.right="0",this.eventDom.style.top="0",this.eventDom.style.bottom="0",this.eventDom.style.zIndex="1",this.eventDom.ondragstart=function(e){e.preventDefault(),e.stopPropagation()}}},{key:"addEventListener",value:function(){this.eventDom.addEventListener("mousedown",this.onMouseDown),this.eventDom.addEventListener("mousemove",this.onMouseMove),this.eventDom.addEventListener("mouseup",this.onMouseUp),this.eventDom.addEventListener("dblclick",this.onMouseDblClick),this.eventDom.addEventListener("mousewheel",this.onMouseWheel)}},{key:"removeEventListener",value:function(){this.eventDom.removeEventListener("mousedown",this.onMouseDown),this.eventDom.removeEventListener("mousemove",this.onMouseMove),this.eventDom.removeEventListener("mouseup",this.onMouseUp),this.eventDom.removeEventListener("mousewheel",this.onMouseWheel)}},{key:"handleMapPanStart",value:function(e){this.dragging=!0,this.map.setCursor(Ni.Grabbing),document.onmousemove=this.handleMapPanMove,document.onmouseup=this.handleMapPanEnd}},{key:"handleMapPanMove",value:function(e){var t=this.getDltXY(e),e=t.x,t=t.y;this.map.onDrag(e,t)}},{key:"handleMapPanEnd",value:function(e){this.dragging=!1,this.map.setCursor(Ni.Grab),document.onmousemove=null,document.onmouseup=null;var t=this.getDltXY(e),n=t.x,r=t.y,e=this.map.getScreenCenter(),t=e.x,e=e.y,r=this.map.transformScreenToGlobal({x:t-n,y:e-r});this.map.reset().setCenter(r)}},{key:"getDltXY",value:function(e,t){var n=(t||{}).transform,r=void 0!==n&&n,i=this.map.getScale(),t=e.screenX,n=e.screenY,e=this.startPageScreenPoint,t=t-e.x,e=n-e.y;return{x:r?t/i:t,y:r?e/i:e}}},{key:"clearDownTimer",value:function(){this.downTimer&&(window.clearTimeout(this.downTimer),this.downTimer=null)}},{key:"handleMarkerStart",value:function(e){var t=this;this.clearDownTimer(),this.downTimer=window.setTimeout(function(){t.map.eventsObServer.emit(Wi.DrawDone,t.map.mode,{x:t.startPoint.global.x,y:t.startPoint.global.y})},300)}},{key:"handlePointStart",value:function(e){var t=this;this.clearDownTimer(),this.downTimer=window.setTimeout(function(){t.map.eventsObServer.emit(Wi.DrawDone,t.map.mode,{x:t.startPoint.global.x,y:t.startPoint.global.y})},300)}},{key:"handleCircleStart",value:function(e){var t=this;this.dragging=!0,document.onmousemove=function(e){return t.handleCircleMove(e)},document.onmouseup=function(e){return t.handleCircleEnd(e)}}},{key:"handleCircleMove",value:function(e){var t=this.startPoint.global,n=t.x,r=t.y,t=this.getDltXY(e,{transform:!1}),e=t.x,t=t.y,t=Math.sqrt(e*e+t*t);this.map.overlayLayer.addCircleFeature({cx:n,cy:r,sr:t,stroke:!0,fill:!1})}},{key:"handleCircleEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null;var t=this.startPoint.global,n=t.x,r=t.y,i=this.getDltXY(e,{transform:!0}),o=i.x,t=i.y,i=this.getDltXY(e,{transform:!1}),e=i.x,i=i.y,t=Math.sqrt(o*o+t*t),i=Math.sqrt(e*e+i*i);this.reset(),Math.abs(t)<=0||Math.abs(i)<=0?console.warn("the circle is too small..."):this.map.eventsObServer.emit(Wi.DrawDone,this.map.mode,{cx:n,cy:r,r:t},{cx:n,cy:r,sr:i})}},{key:"handleLineStart",value:function(e){var t=this;0===this.tmpPointsStore.length&&(this.clearDownTimer(),this.downTimer=window.setTimeout(function(){t.tmpPointsStore.push(t.startPoint)},300))}},{key:"handleLineMove",value:function(e){var t=e.offsetX,n=e.offsetY;1===this.tmpPointsStore.length&&(e=this.tmpPointsStore[0].global,n=this.map.transformScreenToGlobal({x:t,y:n}),this.map.overlayLayer.addLineFeature({start:e,end:n}))}},{key:"handleLineEnd",value:function(e){var t,n;1===this.tmpPointsStore.length&&(t=this.tmpPointsStore[0].global,n=this.startPoint.global,this.map.eventsObServer.emit(Wi.DrawDone,this.map.mode,{start:t,end:n})),this.reset()}},{key:"handlePolylineStart",value:function(e){var t=this;0===this.tmpPointsStore.length?(this.clearDownTimer(),this.downTimer=window.setTimeout(function(){t.tmpPointsStore.push(t.startPoint)},300)):this.tmpPointsStore.push(this.startPoint)}},{key:"handlePolylineMove",value:function(e){var t=e.offsetX,e=e.offsetY,t=this.map.transformScreenToGlobal({x:t,y:e}),e=Ji(this.tmpPointsStore,function(e){return e.global});e.push(t),1<e.length&&this.map.overlayLayer.addPolylineFeature({points:e})}},{key:"handlePolylineEnd",value:function(e){this.tmpPointsStore.pop(),2<=this.tmpPointsStore.length&&this.map.eventsObServer.emit(Wi.DrawDone,this.map.mode,Ji(this.tmpPointsStore,function(e){return e.global})),this.reset()}},{key:"handleRectStart",value:function(e){this.dragging=!0,document.onmousemove=this.handleRectMove,document.onmouseup=this.handleRectEnd}},{key:"handleRectMove",value:function(e){var t=this.startPoint.global,n=t.x,r=t.y,t=this.getDltXY(e,{transform:!0}),e=t.x,t=t.y,t={x:Math.min(n,n+e),y:Math.max(r,r-t),width:Math.abs(e),height:Math.abs(t)};this.map.overlayLayer.addRectFeature(t)}},{key:"handleRectEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null;var t=this.map.getScale(),n=this.startPoint.screen,r=n.x,i=n.y,o=this.getDltXY(e),a=o.x,n=o.y,e=Math.abs(a)/t,o=Math.abs(n)/t,t=i+n,r=Math.min(r+a,r),i=Math.min(t,i),i=this.map.transformScreenToGlobal({x:r,y:i});this.reset(),Math.abs(a)<=3||Math.abs(n)<=3?console.warn("the rect is too small..."):(o={x:i.x,y:i.y,width:e,height:o},this.map.eventsObServer.emit(Wi.DrawDone,this.map.mode,o))}},{key:"handlePolygonStart",value:function(e){var t=this;0===this.tmpPointsStore.length?(this.clearDownTimer(),this.downTimer=window.setTimeout(function(){t.tmpPointsStore.push(t.startPoint)},300)):this.tmpPointsStore.push(this.startPoint)}},{key:"handlePolygonMove",value:function(e){var t=e.offsetX,e=e.offsetY,t=this.map.transformScreenToGlobal({x:t,y:e}),e=Ji(this.tmpPointsStore,function(e){return e.global});e.push(t),1<e.length&&this.map.overlayLayer.addPolygonFeature({points:e})}},{key:"handlePolygonEnd",value:function(e){var t;this.tmpPointsStore.pop(),3<=this.tmpPointsStore.length&&(t=Ji(this.tmpPointsStore,function(e){return e.global}),this.map.eventsObServer.emit(Wi.DrawDone,this.map.mode,t)),this.reset()}},{key:"handleMaskStart",value:function(e){this.dragging=!0,document.onmousemove=this.handleMaskMove,document.onmouseup=this.handleMaskEnd,this.tmpPointsStore.push(this.startPoint);var t=Ji(this.tmpPointsStore,function(e){return e.global});switch(this.map.mode){case Bi.DrawMask:this.map.overlayLayer.addDrawAction({points:t});break;case Bi.ClearMask:this.handleMaskClearMoving({points:t})}}},{key:"handleMaskMove",value:function(e){var t=this.startPoint.screen,n=t.x,t=t.y,e=this.getDltXY(e),t={x:n+e.x,y:t+e.y},e=this.map.transformScreenToGlobal(t);this.tmpPointsStore.push({screen:t,global:e});var r=Ji(this.tmpPointsStore,function(e){return e.global});switch(this.map.mode){case Bi.DrawMask:this.map.overlayLayer.addDrawAction({points:r});break;case Bi.ClearMask:this.handleMaskClearMoving({points:r})}}},{key:"handleMaskEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null;var t=Ji(this.tmpPointsStore,function(e){return e.global});this.map.eventsObServer.emit(Wi.DrawDone,this.map.mode,t),this.reset(),this.handleMaskClearMoving({reset:!0})}},{key:"handleMaskClearMoving",value:function(e){var t=e.points,n=void 0===t?[]:t,t=e.reset,r=void 0!==t&&t,e=this.map.getLayers(),i=this.map.drawingStyle,t=i.lineWidth,o=(void 0===t?10:t)/this.map.getScale();sn(e,function(e){var t;e.type!==Io.Mask||r?e.type===Io.Mask&&r&&e.setMovingClearAction(null):(t=new Eo("".concat(+new Date),{points:n,width:o},{},i),e.setMovingClearAction(t))})}},{key:"handleMapZoom",value:function(e){var t={x:e.offsetX,y:e.offsetY},n={screen:t,global:this.map.transformScreenToGlobal(t)},t=e.deltaY<0?95*this.map.zoom/100:105.263*this.map.zoom/100,e=this.map.getScreenCenter(),n=this.map.transformScreenToGlobal(e,{basePoint:n,zoom:t});this.map.centerAndZoom({center:n,zoom:t})}},{key:"handleFeatureSelect",value:function(e){var t=this.startPoint.global,n=this.map.getLayers(),r=[];sn(n,function(e){if(e.type===Io.Feature){e=e.getTargetFeatureWithPoint(t);if(e)return r.push(e),!1}});n=Qn(r,"[0]",null);n&&this.map.eventsObServer.emit(Wi.FeatureSelected,n)}},{key:"handleActiveFeatureCapture",value:function(e){var r=this,i={x:e.offsetX,y:e.offsetY},t=this.map.transformScreenToGlobal(i),n=this.map.activeFeature,e=n||{},o=e.type,a=e.shape;switch(this.hoverFeature=null,this.hoverFeatureIndex=void 0,o){case _o.Point:n.captureWithPoint(t)&&(this.hoverFeature=n,this.map.setCursor(Ni.Pointer));break;case _o.Rect:case _o.Circle:var s=o===_o.Rect?n.getPoints():n.getEdgePoints();sn(s,function(e,t){e=r.map.transformGlobalToScreen(e);if(To.MathUtil.distance(e,i)<=5){t=1===(r.hoverFeatureIndex=t)||3===t?Ni.NESW_Resize:Ni.NWSE_Resize;return r.map.setCursor(t),!1}}),!nr(this.hoverFeatureIndex)&&n.captureWithPoint(t)&&(this.hoverFeature=n,this.map.setCursor(Ni.Move));break;case _o.Line:case _o.Polyline:case _o.Polygon:var u=o===_o.Line,l=o===_o.Polyline;_o.Polygon;var h=a.start,c=a.end,s=a.points,f=u?[h,c]:void 0===s?[]:s;sn(f,function(e,t){var n=r.map.transformGlobalToScreen(e);if(To.MathUtil.distance(n,i)<=5)return r.hoverFeatureIndex=t,r.map.setCursor(Ni.Pointer),!1;if(!u){if(l&&!f[t+1])return!1;n=f[t+1]||f[0],n=To.MathUtil.getMiddlePoint(e,n),n=r.map.transformGlobalToScreen(n);return To.MathUtil.distance(n,i)<=5?(r.hoverFeatureIndex=t+.5,r.map.setCursor(Ni.Pointer),!1):void 0}}),!nr(this.hoverFeatureIndex)&&n.captureWithPoint(t)&&(this.hoverFeature=n,this.map.setCursor(Ni.Move))}}},{key:"handleActiveFeatureStart",value:function(e){var t=To.EventUtil.getButtonIndex(e);0===t?(this.dragging=!0,document.onmousemove=this.handleActiveFeatureMove,document.onmouseup=this.handleActiveFeatureEnd):2===t&&this.handleActiveFeatureElse(e)}},{key:"handleActiveFeatureMove",value:function(e){var r=this,t=this.getDltXY(e,{transform:!0}),i=t.x,o=t.y,e=this.getDltXY(e,{transform:!1}),n=e.x,a=e.y,s=this.map.activeFeature,u=s.type,l=s.shape,h=s.style;switch(u){case _o.Point:var c=l.x,f=l.y;this.toUpdateShape=O(O({},l),{},{x:c+i,y:f-o}),this.map.overlayLayer.addActiveFeature(s),this.map.overlayLayer.addPointFeature(this.toUpdateShape,{clear:!1,style:O(O({},h),{},{fillStyle:"#FF0000"})});break;case _o.Circle:var v=l.cx,d=l.cy,c=l.r,f=l.sr;if(this.hoverFeature)this.toUpdateShape=O(O({},l),{},{cx:v+i,cy:d-o});else if(nr(this.hoverFeatureIndex)){var v=0===this.hoverFeatureIndex||3===this.hoverFeatureIndex,y=1===this.hoverFeatureIndex||2===this.hoverFeatureIndex,p=s.getSubType()===Lo.Global,d=Math.sqrt(i*i+o*o),m=Math.sqrt(n*n+a*a),y=v&&n<=0||y&&0<=n,y=p?y?c+d:c-d:y?f+m:f-m;if(y<=0)return void console.warn("circle update error: invalid radius, radius <= 0");this.toUpdateShape=O(O({},l),p?{r:y}:{sr:y})}this.map.overlayLayer.addActiveFeature(s),this.map.overlayLayer.addCircleFeature(this.toUpdateShape,{clear:!1,style:O(O({},h),{},{lineWidth:1,strokeStyle:"#FF0000"})});break;case _o.Rect:var m=l.x,p=l.y,y=l.width,g=l.height,b=null;this.hoverFeature?b={x:m+i,y:p-o,width:y,height:g}:nr(this.hoverFeatureIndex)&&(S=0===this.hoverFeatureIndex||3===this.hoverFeatureIndex,P=0===this.hoverFeatureIndex||1===this.hoverFeatureIndex,k=S?m+i:m,w=P?p-o:p,S=S?y-i:y+i,P=P?g-o:g+o,b={x:Math.min(k,k+S),y:Math.max(w,w-P),width:Math.abs(S),height:Math.abs(P)}),this.toUpdateShape=O(O({},l),b),this.map.overlayLayer.addActiveFeature(s),this.map.overlayLayer.addRectFeature(this.toUpdateShape,{clear:!1,style:O(O({},h),{},{lineWidth:1,strokeStyle:"#FF0000"})});break;case _o.Line:case _o.Polyline:case _o.Polygon:var x,g=u===_o.Line,k=u===_o.Polyline,w=u===_o.Polygon,S=l.start,P=l.end,b=l.points,M=g?[S,P]:void 0===b?[]:b,D=[];this.hoverFeature?D=Ji(M,function(e){var t=e.x,e=e.y;return{x:t+i,y:e-o}}):nr(this.hoverFeatureIndex)&&(x=parseInt("".concat(this.hoverFeatureIndex),10),sn(M,function(e,t){var n=e.x,e=e.y;t===x&&x===r.hoverFeatureIndex?D.push({x:n+i,y:e-o}):t===x&&x!==r.hoverFeatureIndex?(t=M[t+1]||M[0],t=To.MathUtil.getMiddlePoint({x:n,y:e},t),D.push({x:n,y:e}),D.push({x:t.x+i,y:t.y-o})):D.push({x:n,y:e})})),g?(b=(P=C(D,2))[0],P=P[1],this.toUpdateShape=O(O({},l),{},{start:b,end:P})):this.toUpdateShape=O(O({},l),{},{points:D}),this.map.overlayLayer.addActiveFeature(s),g&&this.map.overlayLayer.addLineFeature(this.toUpdateShape,{clear:!1,style:O(O({},h),{},{strokeStyle:"#FF0000"})}),k&&this.map.overlayLayer.addPolylineFeature(this.toUpdateShape,{clear:!1,style:O(O({},h),{},{strokeStyle:"#FF0000"})}),w&&this.map.overlayLayer.addPolygonFeature(this.toUpdateShape,{clear:!1,style:O(O({},h),{},{lineWidth:1,strokeStyle:"#FF0000"})})}}},{key:"handleActiveFeatureEnd",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null,this.map.overlayLayer.clear();var t=this.map.activeFeature;if(t&&this.map.overlayLayer.addActiveFeature(t),this.toUpdateShape&&t){switch(t.type){case _o.Point:case _o.Circle:case _o.Line:case _o.Polyline:case _o.Rect:case _o.Polygon:this.map.eventsObServer.emit(Wi.FeatureUpdated,t,this.toUpdateShape)}this.toUpdateShape=null}}},{key:"handleActiveFeatureElse",value:function(e){var t=this.map.activeFeature;if(t){var n=t.type,r=t.shape;switch(n){case _o.Point:this.map.eventsObServer.emit(Wi.FeatureDeleted,t);break;case _o.Polyline:case _o.Polygon:var i=n===_o.Polyline;_o.Polygon;var o,a=i?2:3,i=r.points,i=void 0===i?[]:i;nr(this.hoverFeatureIndex)&&i.length>a&&((o=parseInt("".concat(this.hoverFeatureIndex),10))===this.hoverFeatureIndex&&(i=Yi(i,function(e,t){return t!==o}),i=O(O({},r),{},{points:i}),this.map.eventsObServer.emit(Wi.FeatureUpdated,t,i)))}}}},{key:"onMouseDown",value:function(e){var t=e.offsetX,n=e.offsetY,r=e.screenX,i=e.screenY,t={x:t,y:n},n=this.map.transformScreenToGlobal(t);this.startPoint={screen:t,global:n},this.startPageScreenPoint={x:r,y:i};t=this.map.mode,n=this.dragging,r=this.hoverFeature||nr(this.hoverFeatureIndex),i=!n&&!r;!this.map.activeFeature||r?(t===Bi.Pan&&i?this.handleMapPanStart(e):t===Bi.MARKER&&i?this.handleMarkerStart(e):t===Bi.Point&&i?this.handlePointStart(e):t===Bi.Circle&&i?this.handleCircleStart(e):t===Bi.Line&&i?this.handleLineStart(e):t===Bi.Polyline&&i?this.handlePolylineStart(e):t===Bi.Rect&&i?this.handleRectStart(e):t===Bi.Polygon&&i?this.handlePolygonStart(e):t!==Bi.DrawMask&&t!==Bi.ClearMask||!i||this.handleMaskStart(e),r&&!n&&this.handleActiveFeatureStart(e)):this.map.eventsObServer.emit(Wi.FeatureUnselected,this.map.activeFeature,"cancel by click")}},{key:"onMouseMove",value:function(e){this.mouseMoveEvent=e;var t=this.map.mode,n=this.dragging;t!==Bi.Pan||n?(t!==Bi.MARKER||n)&&(t!==Bi.Point||n)&&(t!==Bi.Circle||n)?t!==Bi.Line||n?t!==Bi.Polyline||n?t!==Bi.Rect||n?t!==Bi.Polygon||n?t!==Bi.DrawMask&&t!==Bi.ClearMask||n||this.map.setCursor(Ni.Crosshair):(this.map.setCursor(Ni.Crosshair),this.handlePolygonMove(e)):this.map.setCursor(Ni.Crosshair):(this.map.setCursor(Ni.Crosshair),this.handlePolylineMove(e)):(this.map.setCursor(Ni.Crosshair),this.handleLineMove(e)):this.map.setCursor(Ni.Crosshair):this.map.setCursor(Ni.Grab),Oo([Bi.Point,Bi.Circle,Bi.Line,Bi.Polyline,Bi.Rect,Bi.Polygon],t)&&!n&&this.handleActiveFeatureCapture(e)}},{key:"onMouseUp",value:function(e){}},{key:"onMouseDblClick",value:function(e){var t=this.map.mode;this.clearDownTimer();var n=this.dragging||this.tmpPointsStore.length;t===Bi.Line&&n?this.handleLineEnd(e):t===Bi.Polyline&&n?this.handlePolylineEnd(e):t===Bi.Polygon&&n&&this.handlePolygonEnd(e),Oo([Bi.Point,Bi.Circle,Bi.Line,Bi.Polyline,Bi.Rect,Bi.Polygon],t)&&!n&&this.handleFeatureSelect(e)}},{key:"onMouseWheel",value:function(e){e.preventDefault(),this.map.mode===Bi.Pan&&this.handleMapZoom(e)}},{key:"reset",value:function(){this.tmpPointsStore=[],this.map.overlayLayer.clear()}},{key:"refresh",value:function(){v(h(i.prototype),"refresh",this).call(this)}}]),i}(),Uo=function(){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};s(this,i),this.id=e,this.type=t,this.props=n,this.style=Gt({},i.defaultStyle,r)}return n(i,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){var e,t=null===(e=this.layer)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.activeFeature;t&&t.id===this.id&&this.layer.map.setActiveFeature(null)}},{key:"getBounds",value:function(){return{x:0,y:0,width:0,height:0}}},{key:"captureWithPoint",value:function(e){return!1}},{key:"updateShape",value:function(e){this.shape=e,null!==(e=this.layer)&&void 0!==e&&e.refresh();var t=null===(e=this.layer)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.activeFeature;t&&t.id===this.id&&this.layer.map.setActiveFeature(this)}},{key:"setStyle",value:function(e,t){var n,t=t.refresh,t=void 0===t||t;this.style=e,t&&null!==(n=this.layer)&&void 0!==n&&n.refresh()}},{key:"refresh",value:function(){}},{key:"printInfo",value:function(){}}]),i}();u(Uo,"defaultStyle",{opacity:1,fillStyle:"rgba(255, 0, 0, 0)",lineWidth:1,strokeStyle:"#000"});var zo=function(){l(a,Uo);var o=f(a);function a(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=4<arguments.length?arguments[4]:void 0;return s(this,a),u(c(r=o.call(this,e,_o.Point,n,r)),"option",{}),r.shape=t,r.option=Gt({},a.defaultOption,i||{}),r}return n(a,[{key:"captureWithPoint",value:function(e){var t=this.shape,n=t.x,r=t.y,i=t.r,o=t.sr,t=null===(t=this.layer)||void 0===t||null===(a=t.map)||void 0===a?void 0:a.getScale(),a=t?3/t:0,a=nr(i)?i+a:nr(o)?o/t+a:a;return To.MathUtil.pointInPoint(e,{x:n,y:r},{tolerance:a})}},{key:"refresh",value:function(){var e=this.shape,t=e.x,n=e.y,r=e.r,i=e.sr,o=this.layer.map.transformGlobalToScreen({x:t,y:n}),a=o.x,s=o.y,e=jo.dpr,t=this.layer.map.getScale(),n=a*e,o=s*e,a=(nr(r)?r*t:nr(i)?i:2)*e;Fo.drawPoint(this.layer.canvasContext,{x:n,y:o,r:a},this.style,{}),this.option.active&&(Fo.drawLine(this.layer.canvasContext,{start:{x:r=s=n-a-2,y:i=t=o-a-2},end:{x:n=s+(e=2*a+4),y:a=i+(o=2*a+4)}},{strokeStyle:"#fff"}),Fo.drawLine(this.layer.canvasContext,{start:{x:n,y:i},end:{x:r,y:a}},{strokeStyle:"#fff"}),Fo.drawRect(this.layer.canvasContext,{x:s,y:t,width:e,height:o},{strokeStyle:"#666"}))}}]),a}();u(zo,"defaultOption",{active:!1});var Go=function(){l(o,Uo);var i=f(o);function o(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return s(this,o),(r=i.call(this,e,_o.Line,n,r)).shape=t,r}return n(o,[{key:"captureWithPoint",value:function(e){var t=this.shape,n=t.start,r=t.end,i=t.width,o=null===(t=this.layer)||void 0===t||null===(o=t.map)||void 0===o?void 0:o.getScale(),o=o?3/o:0,o=nr(i)?i/2+o:o;return To.MathUtil.pointInPolyline(e,[n,r],{tolerance:o})}},{key:"refresh",value:function(){var e=this.shape,t=e.start,n=e.end,r=e.width,i=this.layer.map.transformGlobalToScreen(t),o=i.x,a=i.y,e=this.layer.map.transformGlobalToScreen(n),t=e.x,i=e.y,n=jo.dpr,e=(r||0)*this.layer.map.getScale();Fo.drawLine(this.layer.canvasContext,O({start:{x:o*n,y:a*n},end:{x:t*n,y:i*n}},nr(r)?{width:e*n}:{}),this.style,{})}}]),o}(),Bo=function(){l(o,Uo);var i=f(o);function o(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return s(this,o),(r=i.call(this,e,_o.Polyline,n,r)).shape=t,r}return n(o,[{key:"captureWithPoint",value:function(e){var t=this.shape,n=t.points,r=void 0===n?[]:n,n=t.width,i=null===(t=this.layer)||void 0===t||null===(i=t.map)||void 0===i?void 0:i.getScale(),i=i?3/i:0,i=nr(n)?n/2+i:i;return To.MathUtil.pointInPolyline(e,r,{tolerance:i})}},{key:"refresh",value:function(){var n=this,r=jo.dpr,i=this.layer.map.getScale();Fo.drawPolyline(this.layer.canvasContext,this.shape,this.style,{format:function(e){var t=e.points,e=e.width;return O({points:Ji(t,function(e){var t=n.layer.map.transformGlobalToScreen(e),e=t.x,t=t.y;return{x:e*r,y:t*r}})},nr(e)?{width:e*i*r}:{})}})}}]),o}(),Wo=function(){l(o,Uo);var i=f(o);function o(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return s(this,o),(r=i.call(this,e,_o.Rect,n,r)).shape=t,r}return n(o,[{key:"captureWithPoint",value:function(e){return To.MathUtil.pointInRect(e,this.shape)}},{key:"getPoints",value:function(){var e=this.shape,t=e.x,n=e.y,r=t+e.width,e=n-e.height;return[{x:t,y:n},{x:r,y:n},{x:r,y:e},{x:t,y:e}]}},{key:"refresh",value:function(){var i=this,o=jo.dpr,a=this.layer.map.getScale();Fo.drawRect(this.layer.canvasContext,this.shape,this.style,{format:function(e){var t=e.x,n=e.y,r=e.width,e=e.height,t=i.layer.map.transformGlobalToScreen({x:t,y:n}),n=t.x,t=t.y;return{x:n*o,y:t*o,width:r*a*o,height:e*a*o}}})}}]),o}(),No=function(){l(o,Uo);var i=f(o);function o(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return s(this,o),(r=i.call(this,e,_o.Polygon,n,r)).shape=t,r}return n(o,[{key:"captureWithPoint",value:function(e){var t=this.shape.points;return To.MathUtil.pointInPolygon(e,void 0===t?[]:t)}},{key:"refresh",value:function(){var n=this,e=this.shape,t=e.points;e.inner;var r=jo.dpr;Fo.drawPolygon(this.layer.canvasContext,t,this.style,{format:function(e){var t=n.layer.map.transformGlobalToScreen(e),e=t.x,t=t.y;return{x:e*r,y:t*r}}})}}]),o}(),Yo=function(){l(a,Uo);var o=f(a);function a(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=4<arguments.length?arguments[4]:void 0;return s(this,a),u(c(r=o.call(this,e,_o.Circle,n,r)),"option",{}),r.shape=t,r.option=Gt({},a.defaultOption,i||{}),r}return n(a,[{key:"getSubType",value:function(){var e=this.shape,t=e.r,e=e.sr;return nr(t)?Lo.Global:nr(e)?Lo.Screen:void 0}},{key:"captureWithPoint",value:function(e){var t=this.getSubType()===Lo.Global,n=this.getSubType()===Lo.Screen,r=this.shape,i=r.cx,o=r.cy,a=r.r,s=r.sr,r=null===(r=this.layer)||void 0===r||null===(u=r.map)||void 0===u?void 0:u.getScale(),u=r?3/r:0;return To.MathUtil.pointInPoint(e,{x:i,y:o},{tolerance:t?a+u:n?s/r+u:u})}},{key:"getEdgePoints",value:function(){var e=this.getSubType()===Lo.Global,t=this.getSubType()===Lo.Screen,n=this.shape,r=n.cx,i=n.cy,o=n.r,n=n.sr,n=e?o:t?n:0,n=Math.sqrt(n*n/2);if(e)return[{x:r-n,y:i+n},{x:r+n,y:i+n},{x:r+n,y:i-n},{x:r-n,y:i-n}];if(t){var a=null===(t=this.layer)||void 0===t||null===(a=t.map)||void 0===a?void 0:a.getScale();if(!a)return console.error("circle getEdgePoints error: no added to layer or map"),[];a=n/a;return[{x:r-a,y:i+a},{x:r+a,y:i+a},{x:r+a,y:i-a},{x:r-a,y:i-a}]}return console.error("circle getEdgePoints error: no valid radius"),[]}},{key:"refresh",value:function(){var i=this,o=this.getSubType()===Lo.Global,e=this.shape,t=e.stroke,t=void 0===t||t,e=e.fill,e=void 0!==e&&e,a=jo.dpr,s=this.layer.map.getScale();Fo.drawCircle(this.layer.canvasContext,this.shape,this.style,{format:function(e){var t=e.cx,n=e.cy,r=e.r,e=e.sr,e=o?r*s:nr(e)?e:2,t=i.layer.map.transformGlobalToScreen({x:t,y:n}),n=t.x,t=t.y;return{cx:n*a,cy:t*a,r:e*a}},stroke:t,fill:e})}}]),a}();u(Yo,"defaultOption",{active:!1});var Xo=function(){l(a,Co);var o=f(a);function a(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};return s(this,a),u(c(i=o.call(this,e,Do.Draw,r,i)),"category",""),i.shape=n,i.category=t,i}return n(a,[{key:"refresh",value:function(){var n=this,r=jo.dpr,i=this.layer.map.getScale(),e=O(O({},this.style||{}),{},{lineCap:"round",lineJoin:"round"});Fo.drawPolyline(this.layer.canvasContext,this.shape,e,{format:function(e){var t=e.points,e=e.width;return O({points:Ji(t,function(e){var t=n.layer.map.transformGlobalToScreen(e),e=t.x,t=t.y;return{x:e*r,y:t*r}})},nr(e)?{width:e*i*r}:{})}})}}]),a}(),$o=function(){l(i,jo);var r=f(i);function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return s(this,i),u(c(n=r.call(this,e,Io.Overlay,t,n)),"featureActions",[]),u(c(n),"defaultActiveFeatureStyle",{strokeStyle:"#FF0000",fillStyle:"#FF0000",lineWidth:1}),n}return n(i,[{key:"addFeatureAction",value:function(e,t){t=(t||{}).clear;void 0!==t&&t&&this.clear(),e.onAdd(this),this.featureActions.push(e)}},{key:"addPointFeature",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.style,r=t.clear,r=void 0===r||r,t=t.active,t=void 0!==t&&t,t=new zo("".concat(+new Date),e,{},n||this.map.drawingStyle,{active:t});this.addFeatureAction(t,{clear:r})}},{key:"addLineFeature",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.style,t=t.clear,t=void 0===t||t,n=new Go("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureAction(n,{clear:t})}},{key:"addPolylineFeature",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.style,t=t.clear,t=void 0===t||t,n=new Bo("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureAction(n,{clear:t})}},{key:"addRectFeature",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.style,t=t.clear,t=void 0===t||t,n=new Wo("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureAction(n,{clear:t})}},{key:"addPolygonFeature",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.style,t=t.clear,t=void 0===t||t,n=new No("".concat(+new Date),e,{},n||this.map.drawingStyle);this.addFeatureAction(n,{clear:t})}},{key:"addCircleFeature",value:function(e,t){var n=t||{},r=n.clear,t=void 0===r||r,r=n.style,n=n.active,n=void 0!==n&&n,n=new Yo("".concat(+new Date),e,{},r||this.map.drawingStyle,{active:n});this.addFeatureAction(n,{clear:t})}},{key:"addDrawAction",value:function(e){e=new Xo("".concat(+new Date),"drawAction",e,{},this.map.drawingStyle);this.addFeatureAction(e,{clear:!0})}},{key:"addActiveFeature",value:function(e){var t=this.defaultActiveFeatureStyle,n=e.type,r=e.shape;switch(n){case _o.Point:this.addPointFeature(r,{style:t,active:!0});break;case _o.Line:this.addLineFeature(r,{style:t});var i=r.start,o=r.end;this.addActivePoints([i,o],{withCenterPoint:!1});break;case _o.Polyline:this.addPolylineFeature(r,{style:t}),this.addActivePoints(r.points,{withCenterPoint:!0});break;case _o.Rect:this.addRectFeature(r,{style:t});var a=e.getPoints();this.addActivePoints(a,{withCenterPoint:!1});break;case _o.Polygon:this.addPolygonFeature(r,{style:t}),this.addActivePoints(r.points,{withCenterPoint:!0});break;case _o.Circle:this.addCircleFeature(r,{style:t});a=e.getEdgePoints();this.addActivePoints(a,{withCenterPoint:!1})}}},{key:"addActivePoints",value:function(i){var o=this,e=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).withCenterPoint,a=void 0!==e&&e;sn(i,function(e,t){var n=e.x,r=e.y;o.addCircleFeature({sr:3,cx:n,cy:r,stroke:!1,fill:!0},{clear:!1,style:{fillStyle:"#FF0000"}}),a&&(t=i[t+1]||i[0],t=(e=To.MathUtil.getMiddlePoint(e,t)).x,e=e.y,o.addCircleFeature({sr:3,cx:t,cy:e,stroke:!1,fill:!0},{clear:!1,style:{fillStyle:"#FFDEAD"}}))})}},{key:"refresh",value:function(){v(h(i.prototype),"refresh",this).call(this),sn(this.featureActions,function(e){return e.refresh()})}}]),i}(),Ko=function(){l(i,Ao);var r=f(i);function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return s(this,i),u(c(n=r.call(this,e,Io.Marker,t,n)),"markers",[]),n}return n(i,[{key:"addMarker",value:function(e,t){e.onAdd(this),this.markers.push(e)}},{key:"removeMarkerById",value:function(t){var e=Yi(this.markers,function(e){return e.id!==t||(e.onRemove(),!1)});this.markers=e,this.refresh()}},{key:"removeAllMarkers",value:function(){var e=Yi(this.markers,function(e){return e.onRemove(),!1});this.markers=e,this.refresh()}},{key:"resize",value:function(){this.dom.style.width="0px",this.dom.style.height="0px"}},{key:"refresh",value:function(){v(h(i.prototype),"refresh",this).call(this),sn(this.markers,function(e){return e.refresh()})}}]),i}(),Se=function(){function r(e,t){var n=this;s(this,r),u(this,"layers",[]),u(this,"drawingStyle",{}),u(this,"activeFeature",null),u(this,"events",{on:function(e,t){n.eventsObServer.on(e,t)}}),this.domId=e,this.dom=document.getElementById(e),this.mapOptions=Gt({},r.defaultMapOptions,t),this.zoom=this.mapOptions.zoom,this.center=this.mapOptions.center,this.mode=this.mapOptions.mode,this.setDomStyle(),this.createSubDoms(),this.addOverlayLayer(),this.addEventLayer(),this.addMarkerLayer(),this.eventsObServer=new j.EventEmitter}return n(r,[{key:"setDomStyle",value:function(){this.dom.ondragstart=function(e){e.preventDefault(),e.stopPropagation()},this.dom.oncontextmenu=function(e){e.preventDefault(),e.stopPropagation()}}},{key:"setMode",value:function(e){this.mode=e,this.eventLayer.reset(),this.activeFeature&&this.eventsObServer.emit(Wi.FeatureUnselected,this.activeFeature,"cancel by switch mode")}},{key:"setDrawingStyle",value:function(e){this.drawingStyle=e}},{key:"getSize",value:function(){return this.mapOptions.size||{width:Qn(this.dom,"clientWidth",0),height:Qn(this.dom,"clientHeight",0)}}},{key:"getScale",value:function(e){var t=nr(e)?e:this.zoom,e=this.getSize().width;return parseInt(1e6*e/t+"",10)/1e6}},{key:"setCenter",value:function(e){return this.center=e,this.refresh(),this.triggerBoundsChanged(),this}},{key:"getCenter",value:function(){return this.center}},{key:"getScreenCenter",value:function(){var e=this.getSize();return{x:e.width/2,y:e.height/2}}},{key:"getBounds",value:function(e){var t=this.getSize(),n=t.width,r=t.height,i=this.transformScreenToGlobal({x:0,y:0}),t=i.x,i=i.y,r=this.transformScreenToGlobal({x:n,y:r});return{x:t,y:i,width:r.x-t,height:i-r.y}}},{key:"centerAndZoom",value:function(e){var t=e.center,e=e.zoom;return t&&(this.center=t),nr(e)&&(this.zoom=e),this.refresh(),this.triggerBoundsChanged(),this}},{key:"zoomIn",value:function(){this.zoom=this.zoom/2,this.refresh(),this.triggerBoundsChanged()}},{key:"zoomOut",value:function(){this.zoom=2*this.zoom,this.refresh(),this.triggerBoundsChanged()}},{key:"addLayer",value:function(e){var t=e.dom;this.layerDom.appendChild(t),e.onAdd(this),this.layers.push(e)}},{key:"removeLayerById",value:function(t){var e=Yi(this.layers,function(e){return e.id!==t||(e.onRemove(),!1)});this.layers=e,this.refresh()}},{key:"removeAllLayers",value:function(){var e=Yi(this.layers,function(e){return e.onRemove(),!1});this.layers=e,this.refresh()}},{key:"getLayers",value:function(){return this.layers}},{key:"triggerBoundsChanged",value:function(){var e=this;this.boundsChangedTimer&&(window.clearTimeout(this.boundsChangedTimer),this.boundsChangedTimer=null),this.boundsChangedTimer=window.setTimeout(function(){e.eventsObServer.emit(Wi.BoundsChanged)},666)}},{key:"refresh",value:function(){sn(this.layers,function(e){return e.refresh()}),this.markerLayer.refresh()}},{key:"setActiveFeature",value:function(e){(this.activeFeature=e)&&this.overlayLayer.addActiveFeature(e),e||this.overlayLayer.clear();e=this.eventLayer.mouseMoveEvent;e&&this.eventLayer.onMouseMove(e)}},{key:"getActiveFeature",value:function(){return this.activeFeature}},{key:"transformScreenToGlobal",value:function(e,t){var n=t||{},r=n.basePoint,i=n.zoom,o=this.getScale(i),t=this.getScreenCenter(),n=t.x,i=t.y,t=e.x,e=e.y,n=Qn(r,"screen.x",n),i=Qn(r,"screen.y",i),r=Qn(r,"global",this.center);return{x:r.x+(t-n)/o,y:r.y-(e-i)/o}}},{key:"transformGlobalToScreen",value:function(e,t){var n=t||{},r=n.basePoint,i=n.zoom,o=this.getScale(i),t=this.getScreenCenter(),n=t.x,i=t.y,t=e.x,e=e.y,n=Qn(r,"screen.x",n),i=Qn(r,"screen.y",i),r=Qn(r,"global",this.center);return{x:n+(t-r.x)*o,y:i-(e-r.y)*o}}},{key:"createSubDoms",value:function(){this.setLayerDom(),this.setPlatformDom(),this.setLayerDom2(),this.setControlDom()}},{key:"setLayerDom",value:function(){var e=this.getSize(),t=e.width,e=e.height;this.layerDomId="layer-wrapper-".concat(Jt()),this.layerDom=document.createElement("div"),this.layerDom.setAttribute("id",this.layerDomId),this.layerDom.style.position="absolute",this.layerDom.style.left="0",this.layerDom.style.top="0",this.layerDom.style.width="".concat(t,"px"),this.layerDom.style.height="".concat(e,"px"),this.layerDom.style.zIndex="1",this.dom.appendChild(this.layerDom)}},{key:"setPlatformDom",value:function(){var e=this.getSize(),t=e.width,e=e.height;this.platformDomId="platform-wrapper-".concat(Jt()),this.platformDom=document.createElement("div"),this.platformDom.setAttribute("id",this.platformDomId),this.platformDom.style.position="absolute",this.platformDom.style.left="0",this.platformDom.style.top="0",this.platformDom.style.width="".concat(t,"px"),this.platformDom.style.height="".concat(e,"px"),this.platformDom.style.zIndex="5",this.dom.appendChild(this.platformDom)}},{key:"setLayerDom2",value:function(){this.layerDom2Id="layer2-wrapper-".concat(Jt()),this.layerDom2=document.createElement("div"),this.layerDom2.setAttribute("id",this.layerDom2Id),this.layerDom2.style.position="absolute",this.layerDom2.style.left="0",this.layerDom2.style.right="0",this.layerDom2.style.width="0",this.layerDom2.style.height="0",this.layerDom2.style.zIndex="10",this.dom.appendChild(this.layerDom2)}},{key:"setControlDom",value:function(){this.controlDomId="control-wrapper-".concat(Jt()),this.controlDom=document.createElement("div"),this.controlDom.setAttribute("id",this.controlDomId),this.controlDom.style.position="absolute",this.controlDom.style.left="0",this.controlDom.style.right="0",this.controlDom.style.width="0",this.controlDom.style.height="0",this.controlDom.style.zIndex="15",this.dom.appendChild(this.controlDom)}},{key:"addEventLayer",value:function(){this.eventLayer=new Ro("event-".concat(Jt()),{},{zIndex:5}),this.platformDom.appendChild(this.eventLayer.dom),this.eventLayer.onAdd(this)}},{key:"addOverlayLayer",value:function(){this.overlayLayer=new $o("overlay-".concat(Jt()),{},{zIndex:1}),this.platformDom.appendChild(this.overlayLayer.dom),this.overlayLayer.onAdd(this)}},{key:"addMarkerLayer",value:function(){this.markerLayer=new Ko("marker-".concat(Jt()),{},{zIndex:10}),this.layerDom2.appendChild(this.markerLayer.dom),this.markerLayer.onAdd(this)}},{key:"setCursor",value:function(e){return this.platformDom.style.cursor=e,this}},{key:"setUrlCursor",value:function(e){return this}},{key:"onDrag",value:function(e,t){this.layerDom.style.left="".concat(e,"px"),this.layerDom.style.top="".concat(t,"px"),this.layerDom2.style.left="".concat(e,"px"),this.layerDom2.style.top="".concat(t,"px")}},{key:"reset",value:function(){return this.layerDom.style.left="0",this.layerDom.style.top="0",this.layerDom2.style.left="0",this.layerDom2.style.top="0",this}},{key:"printInfo",value:function(){}}]),r}();u(Se,"defaultMapOptions",{center:{x:0,y:0},zoom:1e3,mode:Bi.Pan,size:null});N=function(){l(o,jo);var i=f(o);function o(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return s(this,o),(r=i.call(this,e,Io.Image,n,r)).imageInfo=Gt({},o.defaultImageInfo,t),r.position=r.imageInfo.position,r.updateImage(),r}return n(o,[{key:"updateImageInfo",value:function(e){this.imageInfo=Gt({},this.imageInfo,e),e.position&&(this.position=this.imageInfo.position),e.src&&this.updateImage(),this.refresh()}},{key:"updateImage",value:function(){var e=this;this.imageInfo.src&&(this.image=new Image,this.image.src=this.imageInfo.src,this.image.onload=function(){return e.refresh()})}},{key:"onAdd",value:function(e){v(h(o.prototype),"onAdd",this).call(this,e),this.refresh()}},{key:"drawImage",value:function(){var e=this.map.transformGlobalToScreen(this.position),t=e.x,n=e.y,r=jo.dpr,i=this.map.getScale(),o=this.imageInfo,e=o.width,o=o.height;Fo.drawImage(this.canvasContext,{image:this.image,x:t*r,y:n*r,width:e*i*r,height:o*i*r},{})}},{key:"refresh",value:function(){v(h(o.prototype),"refresh",this).call(this),this.drawImage()}}]),o}();u(N,"defaultImageInfo",{src:"",width:0,height:0,position:{x:0,y:0}});var Nt=function(){l(i,jo);var r=f(i);function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return s(this,i),u(c(n=r.call(this,e,Io.Feature,t,n)),"features",[]),n}return n(i,[{key:"addFeature",value:function(e,t){t=(t||{}).clear;void 0!==t&&t&&(this.features=[],this.clear()),e.onAdd(this),this.features.push(e)}},{key:"removeFeatureById",value:function(t){var e=Yi(this.features,function(e){return e.id!==t||(e.onRemove(),!1)});this.features=e,this.refresh()}},{key:"removeAllFeatures",value:function(){var e=Yi(this.features,function(e){return e.onRemove(),!1});this.features=e,this.refresh()}},{key:"getTargetFeatureWithPoint",value:function(t){var n=[];return sn(this.features,function(e){if(e.captureWithPoint(t))return n.push(e),!1}),Qn(n,"[0]",null)}},{key:"refresh",value:function(){v(h(i.prototype),"refresh",this).call(this),sn(this.features,function(e){return e.refresh()})}}]),i}(),qo=ae;q=function(e,t){return!!(null==e?0:e.length)&&-1<qo(e,t,0)};ae=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1};var Vo=ye,ye=function(){},ye=Vo&&1/$e(new Vo([,-0]))[1]==1/0?function(e){return new Vo(e)}:ye,Zo=mt,Jo=q,Ho=ae,Qo=pt,ea=ye,ta=$e;var na=function(e,t,n){var r=-1,i=Jo,o=e.length,a=!0,s=[],u=s;if(n)a=!1,i=Ho;else if(200<=o){var l=t?null:ea(e);if(l)return ta(l);a=!1,i=Qo,u=new Zo}else u=t?[]:s;e:for(;++r<o;){var h=e[r],c=t?t(h):h,h=n||0!==h?h:0;if(a&&c==c){for(var f=u.length;f--;)if(u[f]===c)continue e;t&&u.push(c),s.push(h)}else i(u,c,n)||(u!==s&&u.push(c),s.push(h))}return s};var ra=function(e){return e&&e.length?na(e):[]},ia=we,oa=I;q=function(e,t){return e&&ia(t,oa(t),e)};var aa=Y,sa=qe,ua=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},la=Object.prototype.hasOwnProperty;var ha=d,ca=function(e){if(!aa(e))return ua(e);var t,n=sa(e),r=[];for(t in e)("constructor"!=t||!n&&la.call(e,t))&&r.push(t);return r},fa=Re;var ae=function(e){return fa(e)?ha(e,!0):ca(e)},va=we,da=ae;var ya,pt=function(e,t){return e&&va(t,da(t),e)},ye={exports:{}};Re=(d=(Re=(d=($e=ye).exports)&&!d.nodeType&&d)&&$e&&!$e.nodeType&&$e)&&d.exports===Re?_.Buffer:void 0,ya=Re?Re.allocUnsafe:void 0,$e.exports=function(e,t){return t?e.slice():(t=e.length,t=ya?ya(t):new e.constructor(t),e.copy(t),t)};var Re=function(e,t){var n=-1,r=e.length;for(t=t||Array(r);++n<r;)t[n]=e[n];return t},pa=we,ma=F;var $e=function(e,t){return pa(e,ma(e),t)},t=t(Object.getPrototypeOf,Object),ga=ct,ba=t,xa=F,F=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)ga(t,xa(e)),e=ba(e);return t}:On,ka=we,wa=F;var On=function(e,t){return ka(e,wa(e),t)},Sa=kn,Pa=F,Ma=ae;var we=function(e){return Sa(e,Ma,Pa)},Da=Object.prototype.hasOwnProperty;var kn=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Da.call(e,"index")&&(n.index=e.index,n.input=e.input),n},Oa=e;var F=function(e){var t=new e.constructor(e.byteLength);return new Oa(t).set(new Oa(e)),t},Ca=F;var Aa=/\w*$/;var e=L?L.prototype:void 0,ja=e?e.valueOf:void 0;var Fa=F;var Ia=F,_a=function(e,t){return t=t?Ca(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.byteLength)},La=function(e){var t=new e.constructor(e.source,Aa.exec(e));return t.lastIndex=e.lastIndex,t},Ea=function(e){return ja?Object(ja.call(e)):{}},Ta=function(e,t){return t=t?Fa(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.length)};var L=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return Ia(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return _a(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Ta(e,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return La(e);case"[object Set]":return new r;case"[object Symbol]":return Ea(e)}},Ra=Y,Ua=Object.create;function za(){}var Ga=function(e){if(!Ra(e))return{};if(Ua)return Ua(e);za.prototype=e;e=new za;return za.prototype=void 0,e},Ba=t,Wa=qe;var e=function(e){return"function"!=typeof e.constructor||Wa(e)?{}:Ga(Ba(e))},Na=J,Ya=Ze;var F=function(e){return Ya(e)&&"[object Map]"==Na(e)},t=dt,qe=yt.exports,qe=qe&&qe.isMap,F=qe?t(qe):F,Xa=J,$a=Ze;var Ze=function(e){return $a(e)&&"[object Set]"==Xa(e)},dt=dt,yt=yt.exports,yt=yt&&yt.isSet,Ze=yt?dt(yt):Ze,Ka=bn,qa=oe,Va=be,Za=q,Ja=pt,Ha=ye.exports,Qa=Re,es=$e,ts=On,ns=Cn,rs=we,is=J,os=kn,as=L,ss=e,us=ot,ls=at.exports,hs=F,cs=Y,fs=Ze,vs=I,ds=ae,ys="[object Arguments]",ps="[object Function]",ms="[object Object]",gs={};gs[ys]=gs["[object Array]"]=gs["[object ArrayBuffer]"]=gs["[object DataView]"]=gs["[object Boolean]"]=gs["[object Date]"]=gs["[object Float32Array]"]=gs["[object Float64Array]"]=gs["[object Int8Array]"]=gs["[object Int16Array]"]=gs["[object Int32Array]"]=gs["[object Map]"]=gs["[object Number]"]=gs[ms]=gs["[object RegExp]"]=gs["[object Set]"]=gs["[object String]"]=gs["[object Symbol]"]=gs["[object Uint8Array]"]=gs["[object Uint8ClampedArray]"]=gs["[object Uint16Array]"]=gs["[object Uint32Array]"]=!0,gs["[object Error]"]=gs[ps]=gs["[object WeakMap]"]=!1;var bs=function n(r,i,o,e,t,a){var s,u=1&i,l=2&i,h=4&i;if(void 0!==(s=o?t?o(r,e,t,a):o(r):s))return s;if(!cs(r))return r;var c=us(r);if(c){if(s=os(r),!u)return Qa(r,s)}else{var f=is(r),e=f==ps||"[object GeneratorFunction]"==f;if(ls(r))return Ha(r,u);if(f==ms||f==ys||e&&!t){if(s=l||e?{}:ss(r),!u)return l?ts(r,Ja(s,r)):es(r,Za(s,r))}else{if(!gs[f])return t?r:{};s=as(r,f,u)}}u=(a=a||new Ka).get(r);if(u)return u;a.set(r,s),fs(r)?r.forEach(function(e){s.add(n(e,i,o,e,r,a))}):hs(r)&&r.forEach(function(e,t){s.set(t,n(e,i,o,t,r,a))});var v=c?void 0:(h?l?rs:ns:l?ds:vs)(r);return qa(v||r,function(e,t){v&&(e=r[t=e]),Va(s,t,n(e,i,o,t,r,a))}),s};var xs=function(e){return bs(e,5)},ks=function(){function t(e){s(this,t),u(this,"actions",[]),u(this,"map",{getScale:function(){return 1},transformGlobalToScreen:function(e){var t=e.x,n=e.y,e=this.bounds;return{x:t-e.x,y:e.y-n}}}),this.bounds=e,this.createRenderCanvas(),this.map.getScale=this.map.getScale.bind(this),this.map.transformGlobalToScreen=this.map.transformGlobalToScreen.bind(this)}return n(t,[{key:"createRenderCanvas",value:function(){var e=this.bounds,t=e.width,e=e.height;this.canvas=new OffscreenCanvas(t,e),this.canvas.width=t*jo.dpr,this.canvas.height=e*jo.dpr,this.canvasContext=this.canvas.getContext("2d")}},{key:"addAction",value:function(e){e.setStyle({strokeStyle:"#ff0000",fillStyle:"#ff0000"},{refresh:!1}),e.onAdd(this),this.actions.push(e)}},{key:"addActions",value:function(e){var t=this;sn(e,function(e){return t.addAction(e)})}},{key:"getRle",value:function(){for(var e=[],t=jo.dpr,n=this.bounds,r=n.width,i=n.height,o=this.canvas,n=o.width,o=o.height,a=this.canvasContext.getImageData(0,0,n,o).data,s=0,u=1,l=0;l<i;l++)for(var h=0;h<r;h++){var c=4*(l*t*r+h)*t,f=a[c],v=a[1+c],d=a[2+c],c=a[3+c],c=+!!(f||v||d||c);c===u?s++:(e.push(s),s=1),l+1===i&&h+1===r&&e.push(s),u=c}return e}},{key:"refresh",value:function(){sn(this.actions,function(e){return e.refresh()})}},{key:"clear",value:function(){this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height)}}]),t}(),Y=function(){l(i,jo);var r=f(i);function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return s(this,i),u(c(n=r.call(this,e,Io.Mask,t,n)),"actions",[]),n}return n(i,[{key:"addAction",value:function(e,t){e.onAdd(this),this.actions.push(e)}},{key:"removeActionById",value:function(t){var e=Yi(this.actions,function(e){return e.id!==t||(e.onRemove(),!1)});this.actions=e,this.refresh()}},{key:"removeAllActions",value:function(){var e=Yi(this.actions,function(e){return e.onRemove(),!1});this.actions=e,this.refresh()}},{key:"setMovingClearAction",value:function(e){e&&e.onAdd(this),this.movingClearAction=e,this.refresh()}},{key:"getActionCategories",value:function(){var e=this.actions,e=Ji(e,function(e){return e.category});return Yi(ra(e),function(e){return!!e})}},{key:"groupByCategory",value:function(){var t=this.actions,e=this.getActionCategories(),r=[];return sn(e,function(n){var e=Yi(t,function(e){var t=e.type;return e.category===n||t===Do.Clear});r.push({category:n,actions:e})}),r}},{key:"getGroupRleData",value:function(e,t){var n=e.category,e=e.actions,e=void 0===e?[]:e,t=new ks(t),e=xs(e);return t.addActions(e),{category:n,rle:t.getRle()}}},{key:"getRleData",value:function(t){var n=this,e=this.groupByCategory(),r=[];return sn(e,function(e){e=n.getGroupRleData(e,t);r.push(e)}),r}},{key:"refresh",value:function(){v(h(i.prototype),"refresh",this).call(this),sn(this.actions,function(e){return e.refresh()}),this.movingClearAction&&this.movingClearAction.refresh()}}]),i}(),Ze={Text:function(){l(i,jo);var r=f(i);function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return s(this,i),u(c(n=r.call(this,e,Io.Text,t,n)),"texts",[]),n}return n(i,[{key:"addText",value:function(e,t){t=(t||{}).clear;void 0!==t&&t&&this.clear(),e.onAdd(this),this.texts.push(e)}},{key:"removeTextById",value:function(t){var e=Yi(this.texts,function(e){return e.id!==t||(e.onRemove(),!1)});this.texts=e,this.refresh()}},{key:"removeAllTexts",value:function(){var e=Yi(this.texts,function(e){return e.onRemove(),!1});this.texts=e,this.refresh()}},{key:"refresh",value:function(){v(h(i.prototype),"refresh",this).call(this),sn(this.texts,function(e){return e.refresh()})}}]),i}(),Mask:Y,Image:N,Feature:Nt},I={Point:zo,Circle:Yo,Line:Go,Polyline:Bo,Rect:Wo,Polygon:No},ae=function(){l(a,Co);var o=f(a);function a(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};return s(this,a),u(c(i=o.call(this,e,Do.Image,r,i)),"category",""),i.imageInfo=Gt({},a.defaultImageInfo,n),i.position=i.imageInfo.position,i.updateImage(),i.category=t,i}return n(a,[{key:"updateImage",value:function(){var e=this;this.imageInfo.src&&(this.image=new Image,this.image.src=this.imageInfo.src,this.image.onload=function(){return e.layer&&e.refresh()})}},{key:"drawImage",value:function(){var e=this.layer.map.transformGlobalToScreen(this.position),t=e.x,n=e.y,r=jo.dpr,i=this.layer.map.getScale(),o=this.imageInfo,e=o.width,o=o.height;Fo.drawImage(this.layer.canvasContext,{image:this.image,x:t*r,y:n*r,width:e*i*r,height:o*i*r},{})}},{key:"refresh",value:function(){v(h(a.prototype),"refresh",this).call(this),this.drawImage()}}]),a}();u(ae,"defaultImageInfo",{src:"",width:0,height:0,position:{x:0,y:0}});var ws,Y={Draw:Xo,Clear:Eo,Image:ae},Ss=function(){function e(){s(this,e)}return n(e,[{key:"onAdd",value:function(e){}},{key:"onRemove",value:function(){}},{key:"refresh",value:function(){}},{key:"printInfo",value:function(){}}]),e}(),N={Scale:function(){l(t,Ss);var e=f(t);function t(){return s(this,t),e.call(this)}return n(t,[{key:"refresh",value:function(){}}]),t}()};(ws=ws||{}).Text="TEXT";var Ps,Ms,Nt=function(){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};s(this,i),this.id=e,this.type=ws.Text,this.props=n,this.textInfo=Gt({},i.defaultTextInfo,t),this.style=Gt({},i.defaultStyle,r)}return n(i,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){}},{key:"refresh",value:function(){var o=this,e=this.textInfo,a=jo.dpr;Fo.drawText(this.layer.canvasContext,e,this.style,{format:function(e){var t=e.position,n=e.offset,r=o.layer.map.transformGlobalToScreen(t),i=r.x,t=r.y,r=n.x,n=n.y;return O(O({},e),{},{position:{x:i*a,y:t*a},offset:{x:r*a,y:n*a}})}})}},{key:"printInfo",value:function(){}}]),i}();u(Nt,"defaultStyle",{opacity:1,strokeStyle:"#FF0000",background:!0,fontColor:"#FFFFFF",fillStyle:"#FF0000",font:"normal 12px Arial",textAlign:"left",textBaseline:"bottom"}),u(Nt,"defaultTextInfo",{text:"",position:{x:0,y:0},offset:{x:0,y:0}}),(Ps=Ps||{}).Marker="MARKER",(ae=Ms=Ms||{}).Click="click",ae.MouseDown="mouseDown",ae.MouseUp="mouseUp",ae.MouseOver="mouseOver",ae.MouseOut="mouseOut",ae.DragStart="dragStart",ae.Dragging="dragging",ae.DragEnd="dragEnd",ae.RightClick="rightClick";ae=function(){function i(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};s(this,i),u(this,"dragging",!1),u(this,"draggingEnabled",!1),u(this,"events",{on:function(e,t){n.eventsObServer.on(e,t)}}),this.id=e,this.type=Ps.Marker,this.props=r,this.markerInfo=Gt({},i.defaultMarkerInfo,t),this.updateImage(),this.eventsObServer=new j.EventEmitter}return n(i,[{key:"onAdd",value:function(e){this.layer=e,this.refresh()}},{key:"onRemove",value:function(){var e=document.getElementById(this.id);e&&e.remove()}},{key:"enableDragging",value:function(){this.draggingEnabled=!0,this.dragging=!1}},{key:"disableDragging",value:function(){this.draggingEnabled=!1,this.dragging=!1}},{key:"updateImage",value:function(){var e=this;this.markerInfo.src&&(this.image=new Image,this.image.id=this.id,this.image.style.position="absolute",this.image.style.cursor="pointer",this.image.style.userSelect="none",this.image.src=this.markerInfo.src,this.image.onload=function(){e.layer.dom.appendChild(e.image),e.attachEvents()},this.image.onerror=function(){console.error("marker‘s src onerror")})}},{key:"updatePosition",value:function(e){var t=this.markerInfo;this.markerInfo=O(O({},t),{},{position:e}),this.refresh()}},{key:"handleMouseDown",value:function(e){var t=this,n=e.screenX,e=e.screenY;this.startPageScreenPoint={x:n,y:e},this.toUpdatePosition=null,this.eventsObServer.emit(Ms.MouseDown,this),this.draggingEnabled&&(this.dragging=!0,document.onmousemove=function(e){return t.handleMarkerMove(e)},document.onmouseup=function(e){return t.handleMarkerUp(e)},this.eventsObServer.emit(Ms.DragStart,this))}},{key:"handleMarkerMove",value:function(e){var t=this.layer.map.getScale(),n=e.screenX,r=e.screenY,i=this.startPageScreenPoint,o=i.x,e=i.y,i=this.markerInfo.position;this.toUpdatePosition={x:i.x+(n-o)/t,y:i.y-(r-e)/t},this.refresh(this.toUpdatePosition),this.eventsObServer.emit(Ms.Dragging,this,this.toUpdatePosition)}},{key:"handleMarkerUp",value:function(e){this.dragging=!1,document.onmousemove=null,document.onmouseup=null,this.toUpdatePosition&&(this.refresh(),this.eventsObServer.emit(Ms.DragEnd,this,this.toUpdatePosition)),this.toUpdatePosition=null}},{key:"handleMouseUp",value:function(e){this.eventsObServer.emit(Ms.MouseUp,this)}},{key:"handleMouseOver",value:function(e){this.eventsObServer.emit(Ms.MouseOver,this)}},{key:"handleMouseOut",value:function(e){this.eventsObServer.emit(Ms.MouseOut,this)}},{key:"handleClick",value:function(e){2===To.EventUtil.getButtonIndex(e)&&this.eventsObServer.emit(Ms.RightClick,this),this.eventsObServer.emit(Ms.Click,this)}},{key:"attachEvents",value:function(){var t=this;this.image.onmousedown=function(e){return t.handleMouseDown(e)},this.image.onmouseup=function(e){return t.handleMouseUp(e)},this.image.onmouseover=function(e){return t.handleMouseOver(e)},this.image.onmouseout=function(e){return t.handleMouseOut(e)},this.image.onclick=function(e){return t.handleClick(e)}}},{key:"refresh",value:function(e){var t=this.markerInfo,n=t.position,r=t.offset,t=this.layer.map.transformGlobalToScreen(e||n),e=t.x,n=t.y,t=r.x,r=n-r.y;this.image.style.left="".concat(e+t,"px"),this.image.style.top="".concat(r,"px")}},{key:"printInfo",value:function(){}}]),i}();return u(ae,"defaultMarkerInfo",{src:"",position:{x:0,y:0},offset:{x:0,y:0}}),{Map:Se,Layer:Ze,Feature:I,Mask:Y,Control:N,Text:Nt,Marker:ae,Util:To,version:"5.0.0"}});
